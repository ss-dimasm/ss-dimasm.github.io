import{d as ue,a as c,j as n,F as z}from"./index-e8b020c1.js";import{r as w,aZ as me,a_ as qe,a$ as Ye,aQ as je,c as Qe,g as Be,aN as we,aO as C,j as h,I as Y,F as U,ae as Ke,b0 as De,b1 as Je,u as Le,b2 as Ze,b3 as Xe,b4 as en,O as Me,C as ke,x as ie,y as Q,D as nn,b5 as Ie,Z as tn,V as ae,n as T,al as Ce,M as sn,l as P,k as ye,o as B,p as ge,v as he,h as Fe,e as Te,U as on,a2 as an,i as rn,T as ln,f as dn,S as cn,aD as mn}from"./elements-7fcf5525.js";import{g as un,h as gn,a as hn,j as N,m as Se,d as re,u as Oe,a1 as H,q as pn,a2 as bn,e as fn}from"./app-fc3be005.js";import{b as Sn,c as Pn,a as An,u as vn}from"./index-9c9b5ed0.js";import{D as Ee,p as le,I as ne,u as Re}from"./input-price-2174a9ce.js";import{c as Ue}from"./index-9e5feb1c.js";import{c as xe}from"./index-fa19f396.js";import{L as _n}from"./lazy-loaded-image-34c3b1e7.js";import{u as j,g as Pe}from"./use-property-marketing-mode-store-b7706903.js";import{w as In}from"./index-c5c95794.js";import{u as Cn}from"./use-phone-contact-b6fb9426.js";import{u as Ae}from"./index.esm-70abc844.js";import{a as Tn,b as En,L as Nn,R as wn,c as Ln,D as Mn}from"./options-f2badf58.js";import{Q as G,U as kn}from"./url-4ca753ad.js";import{a as yn,b as Fn}from"./index-212ea2b6.js";import{u as On,a as Rn}from"./index-6acf4864.js";import{b as ve,c as Un}from"./date-format-295ec623.js";import{u as We}from"./use-debounced-payload-26b7a5f6.js";import{c as q,e as oe,o as Ge}from"./index.esm-c689e26d.js";import{E as V}from"./error-messages-27b293ab.js";import{u as xn}from"./index-d53a076b.js";import"./index-6f29ff01.js";import"./index-0d5dc733.js";const Wn="local",Gn="5drvq6r056hvp5n9e2729q3q0f",zn="https://connect.reapit.cloud",$n="https://platform.reapit.cloud",Hn="eu-west-2_eQ7dreNzJ",Vn="https://marketplace.reapit.cloud",qn="3b11f2fa-312c-4646-9e14-6754799228c3",Yn="https://applicants.prod.paas.reapit.cloud",jn="https://cowardly-scent.iaas.paas.reapit.cloud",pe={appEnv:Wn,connectClientId:Gn,connectOAuthUrl:zn,platformApiUrl:$n,connectUserPoolId:Hn,marketplaceUrl:Vn,developerPortalAppId:qn,productionDeploymentUrl:Yn,stagingDeploymentUrl:jn},Qn="local",Bn="1vc9gucqv5h657q972nengngmd",Kn="eu-west-2_eQ7dreNzJ",Dn="https://connect.reapit.cloud",Jn="https://platform.reapit.cloud",Zn="https://marketplace.reapit.cloud",Xn="4e0f4ffb-b818-4a62-bce0-1e1b25c29d39",et="https://market-appraisals.prod.paas.reapit.cloud",nt="https://hulking-noise.iaas.paas.reapit.cloud",be={appEnv:Qn,connectClientId:Bn,connectUserPoolId:Kn,connectOAuthUrl:Dn,platformApiUrl:Jn,marketplaceUrl:Zn,developerPortalAppId:Xn,productionDeploymentUrl:et,stagingDeploymentUrl:nt},tt="local",st="36kmi0g5o51af9vdu140jjkbm2",ot="eu-west-2_eQ7dreNzJ",it="https://connect.reapit.cloud",at="https://platform.reapit.cloud",rt="https://marketplace.reapit.cloud",lt="59fd7a7e-6717-467a-a995-d4cd8d2d65e7",dt="https://contact-look-up.prod.paas.reapit.cloud",ct="https://forlorn-plants.iaas.paas.reapit.cloud",fe={appEnv:tt,connectClientId:st,connectUserPoolId:ot,connectOAuthUrl:it,platformApiUrl:at,marketplaceUrl:rt,developerPortalAppId:lt,productionDeploymentUrl:dt,stagingDeploymentUrl:ct},mt=e=>{const t={"APPLICANT-WIZARD":pe.developerPortalAppId,DIARY:ue.developerPortalAppId,"MARKET-APPRAISALS":be.developerPortalAppId,"CONTACT-LOOKUP":fe.developerPortalAppId};return t==null?void 0:t[e]},ut=e=>{var a;const t={SDKMAN_VERSION:"5.15.0",USER:"dimasm",npm_config_user_agent:"yarn/4.0.0 npm/? node/v18.16.1 linux x64",BUN_INSTALL:"/home/dimasm/.bun",GIT_ASKPASS:"/home/dimasm/.vscode-server/bin/f1b07bd25dfad64b0167beb15359ae573aecd2cc/extensions/git/dist/askpass.sh",npm_node_execpath:"/tmp/xfs-ef94648d/node",WT_PROFILE_ID:"{17bf3de4-5353-5709-bcf9-835bd952a95e}",SHLVL:"2",HOME:"/home/dimasm",OLDPWD:"/home/dimasm/projects/work-project/reapit-uk/apps",LESS:"-R",NVM_BIN:"/home/dimasm/.nvm/versions/node/v18.16.1/bin",TERM_PROGRAM_VERSION:"1.83.1",VSCODE_IPC_HOOK_CLI:"/mnt/wslg/runtime-dir/vscode-ipc-eddcb50f-ad5c-4029-a5d4-cdd0d548ce4a.sock",npm_package_json:"/home/dimasm/projects/work-project/reapit-uk/apps/packages/diary/package.json",ZSH:"/home/dimasm/.oh-my-zsh",LSCOLORS:"Gxfxcxdxbxegedabagacad",PAGER:"less",GRADLE_HOME:"/home/dimasm/.sdkman/candidates/gradle/current",VSCODE_GIT_ASKPASS_MAIN:"/home/dimasm/.vscode-server/bin/f1b07bd25dfad64b0167beb15359ae573aecd2cc/extensions/git/dist/askpass-main.js",NODE_OPTIONS:"",VSCODE_GIT_ASKPASS_NODE:"/home/dimasm/.vscode-server/bin/f1b07bd25dfad64b0167beb15359ae573aecd2cc/node",WSL_DISTRO_NAME:"Ubuntu-22.04",COLORTERM:"truecolor",NVM_DIR:"/home/dimasm/.nvm",WAYLAND_DISPLAY:"wayland-0",LOGNAME:"dimasm",PULSE_SERVER:"unix:/mnt/wslg/PulseServer",WSL_INTEROP:"/run/WSL/533_interop",NAME:"Code",_:"/usr/bin/yarn",SDKMAN_CANDIDATES_API:"https://api.sdkman.io/2",USER_ZDOTDIR:"/home/dimasm",TERM:"xterm-256color",PATH:"/tmp/xfs-ef94648d:/home/dimasm/.bun/bin:/home/dimasm/.vscode-server/bin/f1b07bd25dfad64b0167beb15359ae573aecd2cc/bin/remote-cli:/home/dimasm/.sdkman/candidates/gradle/current/bin:/home/dimasm/.bun/bin:/home/dimasm/.nvm/versions/node/v18.16.1/bin:/home/dimasm/.cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/usr/lib/wsl/lib:/mnt/c/Program Files/Common Files/Oracle/Java/javapath:/mnt/c/WINDOWS/system32:/mnt/c/WINDOWS:/mnt/c/WINDOWS/System32/Wbem:/mnt/c/WINDOWS/System32/WindowsPowerShell/v1.0/:/mnt/c/WINDOWS/System32/OpenSSH/:/mnt/c/Program Files/Git/cmd:/mnt/c/Program Files/Go/bin:/mnt/c/Program Files/php-8.1.4:/mnt/c/ProgramData/ComposerSetup/bin:/mnt/c/Program Files/nodejs/:/mnt/c/Program Files/Docker/Docker/resources/bin:/mnt/c/Users/HP/.cargo/bin:/mnt/c/Users/HP/AppData/Local/Microsoft/WindowsApps:/mnt/c/Users/HP/AppData/Local/Programs/Microsoft VS Code/bin:/mnt/c/Users/HP/AppData/Local/Android/Sdk/platform-tools:/mnt/c/Users/HP/go/bin:/mnt/c/Users/HP/AppData/Roaming/Composer/vendor/bin:/mnt/c/Users/HP/AppData/Local/GitHubDesktop/bin:/mnt/c/Users/HP/AppData/Roaming/npm:/mnt/c/Program Files (x86)/BrowserStackLocal/:/home/dimasm/Android/Sdk/tools:/home/dimasm/Android/Sdk/tools/bin:/home/dimasm/Android/Sdk/platform-tools:/home/dimasm/Android/Sdk/emulator:/home/dimasm/Android/Sdk/tools:/home/dimasm/Android/Sdk/tools/bin:/home/dimasm/Android/Sdk/platform-tools:/home/dimasm/Android/Sdk/emulator",SDKMAN_CANDIDATES_DIR:"/home/dimasm/.sdkman/candidates",npm_package_name:"@apps/diary",XDG_RUNTIME_DIR:"/mnt/wslg/runtime-dir",WT_SESSION:"38400a4a-6b8e-4fd7-b90d-79228fea08ab",DISPLAY:":0",LANG:"en_US.UTF-8",VSCODE_INJECTION:"1",LS_COLORS:"rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:mi=00:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arc=01;31:*.arj=01;31:*.taz=01;31:*.lha=01;31:*.lz4=01;31:*.lzh=01;31:*.lzma=01;31:*.tlz=01;31:*.txz=01;31:*.tzo=01;31:*.t7z=01;31:*.zip=01;31:*.z=01;31:*.dz=01;31:*.gz=01;31:*.lrz=01;31:*.lz=01;31:*.lzo=01;31:*.xz=01;31:*.zst=01;31:*.tzst=01;31:*.bz2=01;31:*.bz=01;31:*.tbz=01;31:*.tbz2=01;31:*.tz=01;31:*.deb=01;31:*.rpm=01;31:*.jar=01;31:*.war=01;31:*.ear=01;31:*.sar=01;31:*.rar=01;31:*.alz=01;31:*.ace=01;31:*.zoo=01;31:*.cpio=01;31:*.7z=01;31:*.rz=01;31:*.cab=01;31:*.wim=01;31:*.swm=01;31:*.dwm=01;31:*.esd=01;31:*.jpg=01;35:*.jpeg=01;35:*.mjpg=01;35:*.mjpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.tiff=01;35:*.png=01;35:*.svg=01;35:*.svgz=01;35:*.mng=01;35:*.pcx=01;35:*.mov=01;35:*.mpg=01;35:*.mpeg=01;35:*.m2v=01;35:*.mkv=01;35:*.webm=01;35:*.webp=01;35:*.ogm=01;35:*.mp4=01;35:*.m4v=01;35:*.mp4v=01;35:*.vob=01;35:*.qt=01;35:*.nuv=01;35:*.wmv=01;35:*.asf=01;35:*.rm=01;35:*.rmvb=01;35:*.flc=01;35:*.avi=01;35:*.fli=01;35:*.flv=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:*.xwd=01;35:*.yuv=01;35:*.cgm=01;35:*.emf=01;35:*.ogv=01;35:*.ogx=01;35:*.aac=00;36:*.au=00;36:*.flac=00;36:*.m4a=00;36:*.mid=00;36:*.midi=00;36:*.mka=00;36:*.mp3=00;36:*.mpc=00;36:*.ogg=00;36:*.ra=00;36:*.wav=00;36:*.oga=00;36:*.opus=00;36:*.spx=00;36:*.xspf=00;36:",SDKMAN_DIR:"/home/dimasm/.sdkman",SDKMAN_PLATFORM:"linuxx64",TERM_PROGRAM:"vscode",VSCODE_GIT_IPC_HANDLE:"/mnt/wslg/runtime-dir/vscode-git-6121432122.sock",PROJECT_CWD:"/home/dimasm/projects/work-project/reapit-uk/apps",SHELL:"/usr/bin/zsh",npm_package_version:"0.2",npm_lifecycle_event:"build",VSCODE_GIT_ASKPASS_EXTRA_ARGS:"",PWD:"/home/dimasm/projects/work-project/reapit-uk/apps/packages/diary",BERRY_BIN_FOLDER:"/tmp/xfs-ef94648d",npm_execpath:"/tmp/xfs-ef94648d/yarn",ANDROID_HOME:"/home/dimasm/Android/Sdk",NVM_CD_FLAGS:"-q",ZDOTDIR:"/home/dimasm",HOSTTYPE:"x86_64",WSL2_GUI_APPS_ENABLED:"1",WSLENV:`ELECTRON_RUN_AS_NODE/w:WT_SESSION::WT_PROFILE_ID
`,INIT_CWD:"/home/dimasm/projects/work-project/reapit-uk/apps",NODE_ENV:"production"}.APP_STAGE==="production"?"production":"staging",r={"APPLICANT-WIZARD":{staging:pe.stagingDeploymentUrl,production:pe.productionDeploymentUrl},DIARY:{staging:ue.stagingDeploymentUrl,production:ue.productionDeploymentUrl},"MARKET-APPRAISALS":{staging:be.stagingDeploymentUrl,production:be.productionDeploymentUrl},"CONTACT-LOOKUP":{staging:fe.stagingDeploymentUrl,production:fe.productionDeploymentUrl}};return(a=r==null?void 0:r[e])==null?void 0:a[t]},gt=(e,t)=>{var s;const r=un(),a=gn(r),l=mt(e);return hn({queryKey:G.MARKETPLACE_INSTALLATION.paginated(e),fetchWhenTrue:[!!e,!!l,!!a.connectSession],...t,path:`${kn.MARKETPLACE}/installations`,queryParams:{appId:l,clientId:(s=a.connectSession)==null?void 0:s.loginIdentity.clientId,isInstalled:!0}})},ht=e=>{const[t,r]=w.useState(!1),[a,l]=w.useState(!1),s=e??"root",i=()=>r(!0),o=()=>r(!1),d=()=>l(!0),m=()=>l(!1),p=()=>{window.innerWidth>me?i():d()},u=()=>{m(),o()},S=()=>{!t&&!a||(window.innerWidth>me&&a&&(m(),i()),window.innerWidth<me&&t&&(o(),d()))};w.useEffect(()=>(window.addEventListener("resize",S),()=>{window.removeEventListener("resize",S)}),[t,a]);const A=({children:v,modalIsOpen:g=t,drawerIsOpen:F=a,onModalAndDrawerClose:L=()=>{m(),o()},footerItems:_,...E})=>c(qe,{id:s,children:[n(Ye,{isOpen:F,onDrawerClose:L,footerItems:_,...E,children:v}),n(je,{isOpen:g,onModalClose:L,...E,children:v})]});return w.useMemo(()=>({ModalAndDrawer:A,closeModalAndDrawer:u,openModalAndDrawer:p,isModalAndDrawerOpen:a||t}),[a,t])},pt=e=>{if(N(e))return Se.orderBy(e,["order"])[0]};var ze={exports:{}};(function(e,t){(function(r,a){e.exports=a()})(Qe,function(){return function(r,a){var l=a.prototype,s=l.format;l.format=function(i){var o=this,d=this.$locale();if(!this.isValid())return s.bind(this)(i);var m=this.$utils(),p=(i||"YYYY-MM-DDTHH:mm:ssZ").replace(/\[([^\]]+)]|Q|wo|ww|w|WW|W|zzz|z|gggg|GGGG|Do|X|x|k{1,2}|S/g,function(u){switch(u){case"Q":return Math.ceil((o.$M+1)/3);case"Do":return d.ordinal(o.$D);case"gggg":return o.weekYear();case"GGGG":return o.isoWeekYear();case"wo":return d.ordinal(o.week(),"W");case"w":case"ww":return m.s(o.week(),u==="w"?1:2,"0");case"W":case"WW":return m.s(o.isoWeek(),u==="W"?1:2,"0");case"k":case"kk":return m.s(String(o.$H===0?24:o.$H),u==="k"?1:2,"0");case"X":return Math.floor(o.$d.getTime()/1e3);case"x":return o.$d.getTime();case"z":return"["+o.offsetName()+"]";case"zzz":return"["+o.offsetName("long")+"]";default:return u}});return s.bind(this)(p)}}})})(ze);var bt=ze.exports;const ft=Be(bt);re.extend(ft);const St=({propertyData:e})=>{const{selectedMode:t}=j(),{PhoneContactModal:r,openPhoneContactModal:a}=Cn(),{role:l,primaryContact:s}=Pe(e,t)??{},i=(s==null?void 0:s.name)??xe(s==null?void 0:s.title,s==null?void 0:s.forename,s==null?void 0:s.surname);return c(z,{children:[c(we,{children:[c(C,{spanDesktop:10,spanWideScreen:12,spanSuperWideScreen:16,span4KScreen:20,children:[n(h,{children:"Property Address"}),n(h,{hasGreyText:!0,hasNoMargin:!0,children:Ue(e==null?void 0:e.address)})]}),c(C,{spanDesktop:3,spanWideScreen:4,spanSuperWideScreen:5,span4KScreen:7,children:[n(h,{children:"Owner Name"}),n(h,{hasGreyText:!0,hasNoMargin:!0,children:i})]}),c(C,{spanDesktop:3,spanWideScreen:4,spanSuperWideScreen:5,span4KScreen:6,children:[n(h,{children:"Owner Role"}),n(h,{hasGreyText:!0,hasNoMargin:!0,children:In(l)})]}),c(C,{spanDesktop:4,spanWideScreen:4,spanSuperWideScreen:6,span4KScreen:7,children:[n(h,{children:"Next Call"}),n(h,{hasGreyText:!0,hasNoMargin:!0,children:e!=null&&e.nextCall?re(e==null?void 0:e.nextCall).format("dddd, Do MMMM YYYY"):"-"})]}),N(s)&&N(s==null?void 0:s.email)&&c(C,{spanDesktop:3,spanWideScreen:4,spanSuperWideScreen:5,span4KScreen:7,onClick:()=>window.open(`mailto:${s.email}`,"_blank"),children:[n(h,{children:"Email"}),n(h,{hasGreyText:!0,hasNoMargin:!0,children:s.email})]}),N(s)&&N(s==null?void 0:s.mobilePhone)&&c(C,{spanDesktop:3,spanWideScreen:4,spanSuperWideScreen:5,span4KScreen:6,onClick:()=>a(s.mobilePhone,"mobile"),children:[n(h,{children:"Mobile Phone"}),n(h,{hasGreyText:!0,hasNoMargin:!0,children:s.mobilePhone})]}),N(s)&&N(s==null?void 0:s.homePhone)&&c(C,{spanDesktop:3,spanWideScreen:4,spanSuperWideScreen:6,span4KScreen:7,onClick:()=>a(s.homePhone,"home"),children:[n(h,{children:"Home Phone"}),n(h,{hasGreyText:!0,hasNoMargin:!0,children:s.homePhone})]}),N(s)&&N(s==null?void 0:s.workPhone)&&c(C,{spanDesktop:3,spanWideScreen:4,spanSuperWideScreen:5,span4KScreen:7,onClick:()=>a(s.workPhone,"work"),children:[n(h,{children:"Work Phone"}),n(h,{hasGreyText:!0,hasNoMargin:!0,children:s.workPhone})]})]}),n(r,{})]})};const Pt={primaryImage:"p1gar93n"},At=({propertyData:e})=>{var v;const{isMobile:t,isTablet:r}=Y(),a=Oe(),{ModalAndDrawer:l,openModalAndDrawer:s,closeModalAndDrawer:i}=ht(),{selectedMode:o}=j(),{primaryContact:d}=Pe(e,o)??{},m=pt((v=e==null?void 0:e._embedded)==null?void 0:v.images),p=Ue(H.pick(e==null?void 0:e.address,["line1","line2"])),u=(d==null?void 0:d.name)??xe(d==null?void 0:d.title,d==null?void 0:d.forename,d==null?void 0:d.surname),S=t||r,A=g=>{g.preventDefault(),a(`/${e.id}/images`)};return c(z,{children:[c(U,{isFlexJustifyBetween:!0,isFlexColumn:S,className:"el-mb5 el-col-gap8","data-testid":"header-section-container",children:[S?n(Ke,{"data-testid":"mobile-header-owner-container",onClick:s,children:c(De,{children:[n(Je,{children:n(Le,{icon:"houseInfographic"})}),c(Ze,{children:[n(Xe,{"data-testid":"mobile-header-property-short-address",children:p}),n(en,{"data-testid":"mobile-header-property-owner-name",children:u})]})]})}):c(U,{isFlexColumn:!0,"data-testid":"header-owner-section",children:[c("div",{children:[n(Me,{hasNoMargin:!0,"data-testid":"header-property-short-address",children:p}),n(ke,{"data-testid":"header-property-owner-name",children:u})]}),n(ie,{children:n(Q,{className:"el-mt2",intent:"primary",buttonSize:"large","data-testid":"header-property-owner-button",onClick:s,children:"Details"})})]}),n("div",{className:nn(S&&"el-my5"),"data-testid":"header-hero-primary-property-image-container",children:N(m)?n(_n,{"data-testid":"header-hero-primary-image",className:Pt.primaryImage,src:m.url,onClick:A,fallbackComponent:n(Ie,{"data-testid":"header-hero-primary-image-loading-fallback",placeholder:"placeholderSmall",size:250,fillAvailable:!0})}):n("a",{href:"#",onClick:A,children:n(Ie,{onClick:A,"data-testid":"header-hero-primary-image-not-found-fallback",placeholder:"placeholderLarge",size:250,fillAvailable:!0})})})]}),n(l,{title:"Details",footerItems:n(ie,{alignment:"right",children:n(Q,{intent:"default",onClick:i,children:"Close"})}),children:n(St,{propertyData:e})})]})},_e=e=>{const t=pn(),{success:r}=tn(),{selectedMode:a}=j(),{primaryContact:l}=Pe(e,a)??{},s=e==null?void 0:e.id,i=l==null?void 0:l.id,o=t.getQueryData(G.PROPERTY.single(e==null?void 0:e.id)),d=t.getQueryData(G.CONTACT.single(i)),m=t.getQueryData(G.COMPANY.single(i)),[p,,,{isLoading:u,isSuccess:S}]=Sn(s,{onSuccess:x=>{t.setQueryData(G.PROPERTY.single(s),{...x,_embedded:o==null?void 0:o._embedded})},successMessage:"Property Updated"}),[A,,,{isLoading:v,isSuccess:g}]=Pn(s,{headers:{"If-Match":o==null?void 0:o._eTag}}),[F,,,{isLoading:L,isSuccess:_}]=On(i,{onSuccess:x=>{var J,Z,X,ee;const W=x,de=a==="selling",ce=a==="letting",K=de?se({type:"vendor",data:(J=o==null?void 0:o._embedded)==null?void 0:J.vendor},{type:"contact",data:W}):(Z=o==null?void 0:o._embedded)==null?void 0:Z.vendor,D=ce?se({type:"landlord",data:(X=o==null?void 0:o._embedded)==null?void 0:X.landlord},{type:"contact",data:W}):(ee=o==null?void 0:o._embedded)==null?void 0:ee.landlord;t.setQueryData(G.PROPERTY.single(s),{...o,_embedded:{...o==null?void 0:o._embedded,...K&&{vendor:K},...D&&{landlord:D}}}),t.setQueryData(G.CONTACT.single(i),{...W,_embedded:d==null?void 0:d._embedded})}}),[E,,,{isLoading:b,isSuccess:O}]=Rn(i,{headers:{"If-Match":d==null?void 0:d._eTag}}),[R,,,{isLoading:f,isSuccess:M}]=yn(i,{onSuccess:x=>{var J,Z,X,ee;const W=x,de=a==="selling",ce=a==="letting",K=de?se({type:"vendor",data:(J=o==null?void 0:o._embedded)==null?void 0:J.vendor},{type:"company",data:W}):(Z=o==null?void 0:o._embedded)==null?void 0:Z.vendor,D=ce?se({type:"landlord",data:(X=o==null?void 0:o._embedded)==null?void 0:X.landlord},{type:"company",data:W}):(ee=o==null?void 0:o._embedded)==null?void 0:ee.landlord;t.setQueryData(G.PROPERTY.single(s),{...o,_embedded:{...o==null?void 0:o._embedded,...K&&{vendor:K},...D&&{landlord:D}}}),t.setQueryData(G.COMPANY.single(i),{...W,_embedded:m==null?void 0:m._embedded})}}),[k,,,{isLoading:I,isSuccess:y}]=Fn(i,{headers:{"If-Match":m==null?void 0:m._eTag}});return{updateProperty:async x=>{await A(x),await p({})},updateContact:async(x,W=!1)=>{await E(x),await F({}),!W&&r("Property Updated")},updateCompany:async(x,W=!1)=>{await k(x),await R({}),!W&&r("Property Updated")},isLoading:b||I||v||L||f||u,isSuccess:O||y||g||_||M||S}},se=(e,t)=>{var a,l,s,i,o;if(!e||!t)return e==null?void 0:e.data;const r=[...((a=e==null?void 0:e.data)==null?void 0:a.related)??[]];return r.length>0&&(r[0]={...r[0],...(t==null?void 0:t.type)==="contact"&&{homePhone:(l=t==null?void 0:t.data)==null?void 0:l.homePhone},workPhone:(s=t==null?void 0:t.data)==null?void 0:s.workPhone,mobilePhone:(i=t==null?void 0:t.data)==null?void 0:i.mobilePhone,email:(o=t==null?void 0:t.data)==null?void 0:o.email}),{...e==null?void 0:e.data,related:r}},te=(e=0,t=0)=>{if(e&&!t)return`${e}`;if(!e&&t)return`${t}`;if(e===t)return`${t}`;if(e&&t)return`${e} to ${t}`},vt=({propertyData:e})=>{var E,b,O,R,f,M,k,I,y;const{bedrooms:t,bedroomsMax:r,bathrooms:a,bathroomsMax:l,receptions:s,receptionsMax:i,strapline:o,description:d,notes:m,style:p,type:u}=e,S=p!=null&&p.length?p.map($=>Ee.STYLE[$]):[],A=u!=null&&u.length?u.map($=>Ee.TYPE[$]):[],{register:v,getValues:g}=Ae(),{updateProperty:F}=_e(e),{selectedMode:L}=j(),_=w.useMemo(()=>H.debounce(async()=>{const $=g();await F($)},ve),[]);return c(z,{children:[c(we,{children:[L==="selling"&&c(z,{children:[n(C,{spanMobile:2,spanTablet:2,spanDesktop:2,spanWideScreen:3,children:c(U,{isFlexColumn:!0,"data-testid":"selling-price-and-qualifier",children:[n(h,{children:(E=e==null?void 0:e.selling)!=null&&E.qualifier?Tn[(b=e==null?void 0:e.selling)==null?void 0:b.qualifier]:"Property Price"}),n(h,{hasGreyText:!0,hasNoMargin:!0,children:le((O=e==null?void 0:e.selling)==null?void 0:O.price)})]})}),n(C,{spanMobile:2,spanTablet:2,spanDesktop:2,spanWideScreen:3,children:c(U,{isFlexColumn:!0,"data-testid":"property-selling-status",children:[n(h,{children:"Property Status"}),n(h,{hasGreyText:!0,hasNoMargin:!0,children:(R=e==null?void 0:e.selling)!=null&&R.status?En[e==null?void 0:e.selling.status]:"-"})]})})]}),L==="letting"&&c(z,{children:[n(C,{spanMobile:2,spanTablet:2,spanDesktop:2,spanWideScreen:3,children:c(U,{isFlexColumn:!0,"data-testid":"letting-price-qualifier-and-frequency",children:[c(h,{children:[(f=e==null?void 0:e.letting)!=null&&f.qualifier?Nn[(M=e==null?void 0:e.letting)==null?void 0:M.qualifier].concat(" "):"Rent ",(k=e.letting)!=null&&k.rentFrequency?wn[e.letting.rentFrequency]:""]}),n(h,{hasGreyText:!0,hasNoMargin:!0,children:le((I=e==null?void 0:e.letting)==null?void 0:I.rent)})]})}),n(C,{spanMobile:2,spanTablet:2,spanDesktop:2,spanWideScreen:3,children:c(U,{isFlexColumn:!0,"data-testid":"property-letting-status",children:[n(h,{children:"Property Status"}),n(h,{hasGreyText:!0,hasNoMargin:!0,children:(y=e==null?void 0:e.letting)!=null&&y.status?Ln[e==null?void 0:e.letting.status]:"-"})]})})]}),n(C,{spanMobile:2,spanTablet:2,spanDesktop:2,spanWideScreen:3,children:c(U,{isFlexColumn:!0,"data-testid":"property-bedroom",children:[n(h,{children:"Bedrooms"}),n(h,{hasGreyText:!0,hasNoMargin:!0,children:te(t,r)})]})}),n(C,{spanMobile:2,spanTablet:2,spanDesktop:2,spanWideScreen:3,children:c(U,{isFlexColumn:!0,"data-testid":"property-bathroom",children:[n(h,{children:"Bathrooms"}),n(h,{hasGreyText:!0,hasNoMargin:!0,children:te(a,l)})]})}),n(C,{spanMobile:2,spanTablet:2,spanDesktop:2,spanWideScreen:3,children:c(U,{isFlexColumn:!0,"data-testid":"property-reception",children:[n(h,{children:"Reception Rooms"}),n(h,{hasGreyText:!0,hasNoMargin:!0,children:te(s,i)})]})}),n(C,{spanMobile:2,spanTablet:2,spanDesktop:2,spanWideScreen:3,children:c(U,{isFlexColumn:!0,"data-testid":"property-style-and-type",children:[n(h,{children:"Property Type"}),n(h,{hasGreyText:!0,hasNoMargin:!0,children:S.concat(A).length?S.concat(A).join(", "):"-"})]})})]}),c(U,{isFlexColumn:!0,children:[c("div",{className:"el-mt8",children:[n(h,{children:"Notes"}),n(ae,{children:n(T,{children:n(Ce,{"data-testid":"property-notes",defaultValue:m,...v("notes",{onChange:_}),placeholder:"Notes"})})})]}),c("div",{className:"el-mt8",children:[n(h,{children:"Description"}),n(sn,{children:n(P,{className:"el-mb8",children:n(T,{"data-testid":"property-description-title",...v("strapline",{onChange:_}),defaultValue:o,placeholder:"Title"})})}),n(ae,{children:n(T,{children:n(Ce,{"data-testid":"property-description",...v("description",{onChange:_}),defaultValue:d,placeholder:"Description"})})})]})]})]})},_t=q().shape({serviceCharge:oe().transform((e,t)=>!N(e)||isNaN(e)?0:+t).min(-1,V.HIGHER_OR_EQUAL_THAN("Letting Service","0")),letting:q().shape({lettingFee:q().shape({amount:oe().transform((e,t)=>!N(e)||isNaN(e)?0:+t).min(-1,V.HIGHER_OR_EQUAL_THAN("Letting Fee","0")).when("type",{is:"percentage",then:e=>e.max(100,V.LOWER_OR_EQUAL_THAN("Letting Fee","100"))})}),managementFee:q().shape({amount:oe().transform((e,t)=>!N(e)||isNaN(e)?0:+t).min(-1,V.HIGHER_OR_EQUAL_THAN("Management Fee","0")).when("type",{is:"percentage",then:e=>e.max(100,V.LOWER_OR_EQUAL_THAN("Management Fee","100"))})})})}),It=["letting.lettingFee.amount","letting.lettingFee.type","letting.managementFee.amount","letting.managementFee.type","letting.availableFrom","letting.availableTo","serviceCharge","letting.instructed","valuation","selling.recommendedPrice","selling.agencyId","selling.disposal","selling.fee.amount","selling.fee.type"],$e=e=>t=>{const r=t.target.name;It.includes(r)&&e()},He=e=>({...Se.omit(e,["localFields","metadata","_eTag","_embedded"])});function Ct({propertyData:e}){var E,b,O,R,f,M,k;const{register:t,reset:r,setValue:a,watch:l,formState:s,getValues:i,trigger:o,control:d}=Ae({defaultValues:e,resolver:Ge(_t),mode:"all"}),{isWideScreen:m,isSuperWideScreen:p,is4KScreen:u}=Y(),S=m||p||u?P:ae,{updateProperty:A}=_e(e),{dispatch:v}=We({timeout:ve,onDebounce:I=>{Object.keys(s.errors).length||A(He(I))}}),g=I=>{const y=I.target.name.replace(/\.type$/,"");I.target.value==="percentage"&&a(`${y}.amount`,0),o(`${y}.amount`)},F=I=>{const y=I.target.name.replace(/\.amount$/,"");i(`${y}.type`)||a(`${y}.type`,"percentage")};w.useEffect(()=>{var I,y;e&&(r(e),a("letting.lettingFee.type",(y=(I=e.letting)==null?void 0:I.lettingFee)==null?void 0:y.type))},[e]);const L=l("letting.lettingFee.type")==="percentage",_=l("letting.managementFee.type")==="percentage";return n("form",{onChange:$e(()=>v(i())),children:c(ye,{children:[n(P,{children:n(T,{type:"date",label:"Available From","data-testid":"available-from",max:l("letting.availableTo"),...t("letting.availableFrom")})}),n(P,{children:n(T,{type:"date",label:"Available To","data-testid":"available-to",min:l("letting.availableFrom"),...t("letting.availableTo")})}),n(S,{children:n(ne,{label:"Letting Service","data-testid":"letting-service",control:d,name:"serviceCharge",errorMessage:(E=s.errors.serviceCharge)==null?void 0:E.message})}),n(P,{children:n(ne,{control:d,label:"Letting Fee","data-testid":"letting-fee",onChange:F,name:"letting.lettingFee.amount",errorMessage:(R=(O=(b=s.errors.letting)==null?void 0:b.lettingFee)==null?void 0:O.amount)==null?void 0:R.message})}),n(P,{children:c(T,{children:[n(B,{children:"Use Percentage Letting Fee"}),n(ge,{"data-testid":"letting-fee-toggle",...t("letting.lettingFee.type",{onChange:g}),options:[{id:"yes-use-lettingFee-percentage",value:"percentage",text:"Yes",isChecked:L},{id:"not-use-lettingFee-percentage",value:"fixed",text:"No",isChecked:!L}]})]})}),n(P,{children:n(ne,{control:d,label:"Management Fee","data-testid":"management-fee",onChange:F,name:"letting.managementFee.amount",errorMessage:(k=(M=(f=s.errors.letting)==null?void 0:f.managementFee)==null?void 0:M.amount)==null?void 0:k.message})}),n(P,{children:c(T,{children:[n(B,{children:"Use Percentage Management Fee"}),n(ge,{"data-testid":"management-fee-toggle",...t("letting.managementFee.type",{onChange:g}),options:[{id:"yes-use-managementFee-percentage",value:"percentage",text:"Yes",isChecked:_},{id:"not-use-managementFee-percentage",value:"fixed",text:"No",isChecked:!_}]})]})}),n(P,{children:c(T,{children:[n(B,{children:"Letting Agency"}),n(he,{children:n("option",{value:"",children:"Select Agency"})})]})}),n(P,{children:n(T,{type:"date",label:"Date Instructed","data-testid":"date-instructed",...t("letting.instructed")})}),n(P,{className:"el-mb5",children:n(T,{type:"date",label:"MA Date","data-testid":"ma-date",...t("valuation")})})]})})}const Tt=q().shape({selling:q().shape({fee:q().shape({amount:oe().transform((e,t)=>!N(e)||isNaN(e)?0:+t).min(-1,V.HIGHER_OR_EQUAL_THAN("Commision amount","0")).when("type",{is:"percentage",then:e=>e.max(100,V.LOWER_OR_EQUAL_THAN("Commision amount","100"))})})})});function Et({propertyData:e}){var E,b,O,R;const[t]=Re(),{register:r,reset:a,watch:l,setValue:s,getValues:i,formState:o,trigger:d,control:m}=Ae({defaultValues:e,resolver:Ge(Tt),mode:"all"}),{isWideScreen:p,isSuperWideScreen:u,is4KScreen:S}=Y(),A=p||u||S?P:ae,{updateProperty:v}=_e(e),{dispatch:g}=We({timeout:ve,onDebounce:f=>{Object.keys(o.errors).length||v(He(f))}}),F=f=>{f.target.value==="percentage"?s("selling.fee.amount",0):s("selling.fee.amount",Math.round(i("selling.fee.amount")??0)),d("selling.fee.amount")},L=()=>{i("selling.fee.type")||s("selling.fee.type","percentage")};w.useEffect(()=>{e&&a(e)},[e]);const _=l("selling.fee.type")==="percentage";return n("form",{onChange:$e(()=>g(i())),children:c(ye,{children:[n(A,{children:n(ne,{control:m,"data-testid":"vendor-price",label:"Vendor Price",name:"selling.recommendedPrice"})}),n(P,{children:n(T,{type:"number",onChange:()=>{},value:0,label:"MA Price From"})}),n(P,{children:n(T,{type:"number",onChange:()=>{},value:0,label:"MA Price To"})}),n(P,{children:n(T,{type:"date",label:"MA Date","data-testid":"ma-date",...r("valuation")})}),n(P,{children:c(T,{children:[n(B,{children:"Selling Agency"}),c(he,{"data-testid":"selling-agency",...r("selling.agencyId"),children:[n("option",{disabled:!!l("selling.agencyId"),value:"",children:"Select Agency"}),(E=t==null?void 0:t.agencyTypes)==null?void 0:E.map(({id:f,value:M})=>n("option",{value:f,children:M},f))]})]})}),n(A,{children:c(T,{children:[n(B,{children:"Disposal"}),c(he,{"data-testid":"disposal",...r("selling.disposal"),children:[n("option",{disabled:!!l("selling.disposal"),value:"",children:"Select appointment type"}),Object.entries(Mn).map(([f,M])=>n("option",{value:f,children:M},f))]})]})}),n(P,{children:n(ne,{control:m,allowDecimal:_,label:"Commision",name:"selling.fee.amount",onChange:L,errorMessage:(R=(O=(b=o.errors.selling)==null?void 0:b.fee)==null?void 0:O.amount)==null?void 0:R.message,"data-testid":"commision"})}),n(P,{children:c(T,{children:[n(B,{children:"Use Percentage Commision"}),n(ge,{"data-testid":"commisionTypeToggle",...r("selling.fee.type",{onChange:F}),options:[{id:"yes-use-sellingFee-percentage",value:"percentage",text:"Yes",isChecked:_},{id:"not-use-sellingFee-percentage",value:"fixed",text:"No",isChecked:!_}]})]})})]})})}const Ve=e=>!e||!re(e).isValid()?"-":re(e).format(Un),Nt=e=>{const{isMobile:t,isTablet:r}=Y();return e.map(a=>{var m;const{address:l,bedrooms:s,selling:i,bedroomsMax:o}=a,d=(i==null?void 0:i.status)==="exchanged"?"Exchanged Date":"Completed Date";return{cells:[{label:"Address",value:(l==null?void 0:l.line1)??"-",icon:r||t?"houseInfographic":void 0,narrowTable:{showLabel:!0,order:1}},{label:"Bedrooms",value:te(s,o),icon:r||t?"houseInfographic":void 0,narrowTable:{showLabel:!0,order:1}},{label:t||r?d:"Date Property Changed",value:Ve((m=a==null?void 0:a.localFields)==null?void 0:m.journalEntryCreated),icon:r||t?"calendarSolidSystem":void 0,narrowTable:{showLabel:!0,order:1}},{label:"Sold Price",value:le(i==null?void 0:i.exchangedPrice),icon:r||t?"poundSolidSystem":void 0,narrowTable:{showLabel:!0,order:1}}]}})},wt=e=>{const{isMobile:t,isTablet:r}=Y();return e.map(a=>{var d;const{address:l,bedrooms:s,letting:i,bedroomsMax:o}=a;return{cells:[{label:"House Number",value:(l==null?void 0:l.buildingNumber)??"-",icon:r||t?"houseInfographic":void 0,narrowTable:{showLabel:!0,order:1}},{label:"Address",value:(l==null?void 0:l.line1)??"-",icon:r||t?"houseInfographic":void 0,narrowTable:{showLabel:!0,order:1}},{label:"Bedrooms",value:te(s,o),icon:r||t?"houseInfographic":void 0,narrowTable:{showLabel:!0,order:1}},{label:"Rent Amount",value:le(i==null?void 0:i.rent),icon:r||t?"poundSolidSystem":void 0,narrowTable:{showLabel:!0,order:1}},{label:"Rent Frequency",value:i!=null&&i.rentFrequency?Se.capitalize(i==null?void 0:i.rentFrequency):"-",icon:r||t?"houseInfographic":void 0,narrowTable:{showLabel:!0,order:1}},{label:"Start Date",value:Ve((d=a==null?void 0:a.localFields)==null?void 0:d.journalEntryCreated),icon:r||t?"calendarSolidSystem":void 0,narrowTable:{showLabel:!0,order:1}}]}})},Lt=({postCode:e,marketingMode:t,currentPropertyId:r})=>{const[a,l]=w.useState(1),[s,i]=w.useState([]),[o,d]=w.useState(1),[m,p]=w.useState([]),[u,S]=w.useState([]),A=t==="selling"?{sellingStatus:["exchanged","completed"]}:{lettingStatus:["tenancyCurrent","tenancyFinished"]},v=t==="selling"?["SC","SX"]:["LC","LF"],[g,F,{isLoading:L,isFetching:_,isError:E}]=An({queryParams:{address:e,marketingMode:t,...A,pageNumber:o},fetchWhenTrue:[e&&t]});w.useEffect(()=>{if(g!=null&&g.pageNumber&&(g!=null&&g.totalPageCount)&&g.pageNumber<g.totalPageCount&&d((g==null?void 0:g.pageNumber)+1),g!=null&&g._embedded&&p(k=>k.concat(g._embedded)),o===(g==null?void 0:g.totalPageCount)&&(g!=null&&g._embedded)){const k=[...m,...g._embedded].map(I=>I.id);S(H.uniq(k))}},[g]);const[b,O,{isLoading:R,isFetching:f,isError:M}]=xn({queryParams:{typeId:v,propertyId:u,pageNumber:a,sortBy:"-created"},fetchWhenTrue:[u==null?void 0:u.length]});return w.useEffect(()=>{b!=null&&b.pageNumber&&(b!=null&&b.totalPageCount)&&b.pageNumber<b.totalPageCount&&l((b==null?void 0:b.pageNumber)+1),b!=null&&b._embedded&&i(k=>k.concat(b._embedded))},[b]),{data:Mt({propertiesData:m,journalEntriesData:s,marketingMode:t,currentPropertyId:r}),isLoading:L||R,isFetching:_||f,isError:E||M,error:F||O}},Mt=({propertiesData:e,journalEntriesData:t,marketingMode:r,currentPropertyId:a})=>{if(!(e!=null&&e.length)||!(t!=null&&t.length))return null;const l=Array.from(new Set(t.map(m=>m.propertyId))),s=kt(t),i=e.filter(m=>m.id!==a),o=H.uniqBy(i,"id").reduce((m,p)=>{if(l.includes(p.id)){const u=H.find(s,["propertyId",p.id]);return r==="selling"?m.push({...p,localFields:{journalEntryCreated:u==null?void 0:u.created,journalEntryTypeId:u==null?void 0:u.typeId}}):m.push({...p,localFields:{journalEntryCreated:u==null?void 0:u.created,journalEntryTypeId:u==null?void 0:u.typeId}}),m}return m},[]);return H.orderBy(o,["localFields.journalEntryCreated"],["desc"])},kt=e=>H.uniqBy(e,"propertyId"),yt=({propertyData:e})=>{const{isMobile:t,isTablet:r}=Y(),{selectedMode:a}=j(),{address:l,id:s}=e,{data:i,isLoading:o,isFetching:d,isError:m,error:p}=Lt({postCode:l==null?void 0:l.postcode,marketingMode:a,currentPropertyId:s});return l!=null&&l.postcode?c("div",{children:[n(ke,{hasBoldText:!0,"data-testid":"recently-sold-or-let-title",children:a==="selling"?"Recently Sold Properties":"Recently Let Properties"}),d||o?n(Fe,{}):m?n(Te,{"data-testid":"recently-sold-or-rent-error-notification",isExpanded:!0,isFullWidth:t||r,intent:"danger",children:(p==null?void 0:p.readableMessage)||bn.DEFAULT}):i&&(i!=null&&i.length)?n(on,{"data-testid":"recently-sold-or-let-properties",rows:a==="selling"?Nt(i):wt(i)}):n(Te,{"data-testid":"recently-sold-or-rent-not-found-notification",className:"el-mt8",isExpanded:!0,intent:"default",isInline:!0,isFullWidth:t||r,children:"No Data Found!"})]}):n(z,{})},Ne=({propertyData:e,selectedTab:t})=>{const r=Oe(),{selectedMode:a,hasMultipleMode:l,switchMode:s}=j(e),[i]=gt("DIARY"),o=(i==null?void 0:i.pageCount)!==0;return c(z,{children:[n(Le,{"data-testid":"controls-icon",className:"el-mb5",icon:"propertyManagementInfographic",iconSize:"large"}),n(an,{"data-testid":"controls-description",hasGreyText:!0,children:"This app provides the tools required to document the outcome of a market appraisal appointment and make changes to an existing property record."}),c(ie,{"data-testid":"controls-button-group",children:[t==="summary"&&c(z,{children:[n(Q,{"data-testid":"controls-button-edit",intent:"primary",onClick:()=>r(`/${e==null?void 0:e.id}/edit`),children:"Edit"}),o&&n(Q,{onClick:()=>{const m={confirmation:{includeProperty:!0,includeAttendee:null},appointment:{id:"random-appointment",propertyId:e==null?void 0:e.id,_embedded:{property:e}}},p=new URLSearchParams(H.mapValues(m,u=>JSON.stringify(u)));window.open(`${ut("DIARY")}/create?${p.toString()}`,"_blank")},"data-testid":"controls-button-create-appointment",intent:"primary",children:"Create Appointment"})]}),l&&c(Q,{"data-testid":"controls-button-switch-mode",intent:"primary",onClick:s,children:["Switch to ",a==="selling"?"Rent":"Sales"]})]})]})},Ft=()=>{const{isMobile:e}=Y(),{propertyId:t}=fn(),{Modal:r,openModal:a,closeModal:l}=rn(),[s,i]=w.useState("summary"),[,,{isLoading:o}]=Re(),[d,,{isLoading:m}]=vn(t,{fetchWhenTrue:[!!t],queryParams:{embed:["landlord","vendor","images"]}}),{selectedMode:p}=j(d);return c(U,{isFlexGrow1:!0,children:[c(ln,{children:[n(Me,{children:"Market Appraisals"}),n(Ne,{selectedTab:s,propertyData:d})]}),n(dn,{"data-testid":"view-property-page-container",children:m||o?n(Fe,{fullPage:!0,"data-testid":"view-property-loader"}):N(d)&&c(z,{children:[e&&c(r,{title:"Controls",children:[n(Ne,{selectedTab:s,propertyData:d}),n(ie,{alignment:"center",className:"el-mt5",children:n(Q,{intent:"default",onClick:l,children:"Close"})})]}),n(At,{propertyData:d}),c("div",{className:"el-mb12",children:[n(cn,{name:"view-property-tab",isFullWidth:!0,options:[{id:"summary",value:"summary",text:"Summary",isChecked:s==="summary"},{id:"pricing",value:"pricing",text:"Pricing",isChecked:s==="pricing"},{id:"valuation",value:"valuation",text:"Valuation",isChecked:s==="valuation"}],onChange:S=>i(S.currentTarget.value)}),s==="summary"&&n(vt,{propertyData:d}),s==="pricing"&&(p==="selling"?n(Et,{propertyData:d}):n(Ct,{propertyData:d})),s==="valuation"&&n(yt,{propertyData:d})]}),n(mn,{onClick:a})]})})]})},rs=Ft;export{rs as default};
