import{d as ue,a as d,j as n,F as z}from"./index-b3f50da9.js";import{r as L,aZ as me,a_ as qe,a$ as Ye,aQ as Qe,c as je,g as Be,aN as Le,aO as T,j as h,I as Y,F as O,ae as Ke,b0 as Je,b1 as Ze,u as Me,b2 as De,b3 as Xe,b4 as en,O as Ee,C as ye,x as oe,y as j,D as nn,b5 as Ce,Z as tn,V as ae,n as _,al as Te,M as sn,l as P,k as Fe,o as B,p as ge,v as he,h as ke,e as _e,U as on,a2 as an,i as rn,T as ln,f as cn,S as dn,aD as mn}from"./elements-7fcf5525.js";import{g as un,h as gn,a as hn,j as w,m as Se,d as re,u as Ue,a1 as H,q as pn,a2 as fn,e as bn}from"./app-1088c2df.js";import{b as Sn,c as Pn,a as An,u as vn}from"./index-230a9ce9.js";import{D as Ne,p as le,I as ne,u as xe}from"./input-price-532d65e0.js";import{c as Oe}from"./index-8f0c1425.js";import{c as Re}from"./index-fa19f396.js";import{L as In}from"./lazy-loaded-image-567ccffc.js";import{u as Q,g as Pe}from"./use-property-marketing-mode-store-09297abf.js";import{w as Cn}from"./index-c5c95794.js";import{u as Tn}from"./use-phone-contact-a792a0da.js";import{u as Ae}from"./index.esm-70abc844.js";import{a as _n,b as Nn,L as wn,R as Ln,c as Mn,D as En}from"./options-f2badf58.js";import{Q as G,U as yn}from"./url-ce1d32f5.js";import{a as Fn,b as kn}from"./index-8aa18f6a.js";import{u as Un,a as xn}from"./index-b6bc85a8.js";import{b as ve,c as On}from"./date-format-295ec623.js";import{u as We}from"./use-debounced-payload-fb4fc0f7.js";import{c as q,e as ie,o as Ge}from"./index.esm-c689e26d.js";import{E as V}from"./error-messages-27b293ab.js";import{u as Rn}from"./index-b49523e0.js";import"./index-77752724.js";import"./index-0d5dc733.js";const Wn="local",Gn="5drvq6r056hvp5n9e2729q3q0f",zn="https://connect.reapit.cloud",$n="https://platform.reapit.cloud",Hn="eu-west-2_eQ7dreNzJ",Vn="https://marketplace.reapit.cloud",qn="3b11f2fa-312c-4646-9e14-6754799228c3",Yn="https://applicants.prod.paas.reapit.cloud",Qn="https://cowardly-scent.iaas.paas.reapit.cloud",pe={appEnv:Wn,connectClientId:Gn,connectOAuthUrl:zn,platformApiUrl:$n,connectUserPoolId:Hn,marketplaceUrl:Vn,developerPortalAppId:qn,productionDeploymentUrl:Yn,stagingDeploymentUrl:Qn},jn="local",Bn="1vc9gucqv5h657q972nengngmd",Kn="eu-west-2_eQ7dreNzJ",Jn="https://connect.reapit.cloud",Zn="https://platform.reapit.cloud",Dn="https://marketplace.reapit.cloud",Xn="4e0f4ffb-b818-4a62-bce0-1e1b25c29d39",et="https://market-appraisals.prod.paas.reapit.cloud",nt="https://hulking-noise.iaas.paas.reapit.cloud",fe={appEnv:jn,connectClientId:Bn,connectUserPoolId:Kn,connectOAuthUrl:Jn,platformApiUrl:Zn,marketplaceUrl:Dn,developerPortalAppId:Xn,productionDeploymentUrl:et,stagingDeploymentUrl:nt},tt="local",st="36kmi0g5o51af9vdu140jjkbm2",it="eu-west-2_eQ7dreNzJ",ot="https://connect.reapit.cloud",at="https://platform.reapit.cloud",rt="https://marketplace.reapit.cloud",lt="59fd7a7e-6717-467a-a995-d4cd8d2d65e7",ct="https://contact-look-up.prod.paas.reapit.cloud",dt="https://forlorn-plants.iaas.paas.reapit.cloud",be={appEnv:tt,connectClientId:st,connectUserPoolId:it,connectOAuthUrl:ot,platformApiUrl:at,marketplaceUrl:rt,developerPortalAppId:lt,productionDeploymentUrl:ct,stagingDeploymentUrl:dt},mt=e=>{const t={"APPLICANT-WIZARD":pe.developerPortalAppId,DIARY:ue.developerPortalAppId,"MARKET-APPRAISALS":fe.developerPortalAppId,"CONTACT-LOOKUP":be.developerPortalAppId};return t==null?void 0:t[e]},ut=e=>{var a;const t={SDKMAN_VERSION:"5.15.0",USER:"dimasm",npm_config_user_agent:"yarn/4.0.0 npm/? node/v18.16.1 linux x64",BUN_INSTALL:"/home/dimasm/.bun",npm_node_execpath:"/tmp/xfs-1af92607/node",WT_PROFILE_ID:"{17bf3de4-5353-5709-bcf9-835bd952a95e}",SHLVL:"1",HOME:"/home/dimasm",OLDPWD:"/home/dimasm",LESS:"-R",NVM_BIN:"/home/dimasm/.nvm/versions/node/v18.16.1/bin",npm_package_json:"/home/dimasm/projects/work-project/reapit-uk/apps/packages/diary/package.json",ZSH:"/home/dimasm/.oh-my-zsh",LSCOLORS:"Gxfxcxdxbxegedabagacad",PAGER:"less",GRADLE_HOME:"/home/dimasm/.sdkman/candidates/gradle/current",NODE_OPTIONS:"",WSL_DISTRO_NAME:"Ubuntu-22.04",NVM_DIR:"/home/dimasm/.nvm",WAYLAND_DISPLAY:"wayland-0",LOGNAME:"dimasm",PULSE_SERVER:"unix:/mnt/wslg/PulseServer",WSL_INTEROP:"/run/WSL/8_interop",NAME:"dimas-react",SDKMAN_CANDIDATES_API:"https://api.sdkman.io/2",_:"/usr/bin/yarn",TERM:"xterm-256color",PATH:"/tmp/xfs-1af92607:/home/dimasm/.sdkman/candidates/gradle/current/bin:/home/dimasm/.bun/bin:/home/dimasm/.nvm/versions/node/v18.16.1/bin:/home/dimasm/.cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/usr/lib/wsl/lib:/mnt/c/Program Files/Common Files/Oracle/Java/javapath:/mnt/c/WINDOWS/system32:/mnt/c/WINDOWS:/mnt/c/WINDOWS/System32/Wbem:/mnt/c/WINDOWS/System32/WindowsPowerShell/v1.0/:/mnt/c/WINDOWS/System32/OpenSSH/:/mnt/c/Program Files/Git/cmd:/mnt/c/Program Files/Go/bin:/mnt/c/Program Files/php-8.1.4:/mnt/c/ProgramData/ComposerSetup/bin:/mnt/c/Program Files/nodejs/:/mnt/c/Program Files/Docker/Docker/resources/bin:/mnt/c/Users/HP/.cargo/bin:/mnt/c/Users/HP/AppData/Local/Microsoft/WindowsApps:/mnt/c/Users/HP/AppData/Local/Programs/Microsoft VS Code/bin:/mnt/c/Users/HP/AppData/Local/Android/Sdk/platform-tools:/mnt/c/Users/HP/go/bin:/mnt/c/Users/HP/AppData/Roaming/Composer/vendor/bin:/mnt/c/Users/HP/AppData/Local/GitHubDesktop/bin:/mnt/c/Users/HP/AppData/Roaming/npm:/mnt/c/Program Files (x86)/BrowserStackLocal/:/home/dimasm/Android/Sdk/tools:/home/dimasm/Android/Sdk/tools/bin:/home/dimasm/Android/Sdk/platform-tools:/home/dimasm/Android/Sdk/emulator",SDKMAN_CANDIDATES_DIR:"/home/dimasm/.sdkman/candidates",npm_package_name:"@apps/diary",XDG_RUNTIME_DIR:"/mnt/wslg/runtime-dir",WT_SESSION:"38400a4a-6b8e-4fd7-b90d-79228fea08ab",DISPLAY:":0",LANG:"en_US.UTF-8",LS_COLORS:"rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:mi=00:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arc=01;31:*.arj=01;31:*.taz=01;31:*.lha=01;31:*.lz4=01;31:*.lzh=01;31:*.lzma=01;31:*.tlz=01;31:*.txz=01;31:*.tzo=01;31:*.t7z=01;31:*.zip=01;31:*.z=01;31:*.dz=01;31:*.gz=01;31:*.lrz=01;31:*.lz=01;31:*.lzo=01;31:*.xz=01;31:*.zst=01;31:*.tzst=01;31:*.bz2=01;31:*.bz=01;31:*.tbz=01;31:*.tbz2=01;31:*.tz=01;31:*.deb=01;31:*.rpm=01;31:*.jar=01;31:*.war=01;31:*.ear=01;31:*.sar=01;31:*.rar=01;31:*.alz=01;31:*.ace=01;31:*.zoo=01;31:*.cpio=01;31:*.7z=01;31:*.rz=01;31:*.cab=01;31:*.wim=01;31:*.swm=01;31:*.dwm=01;31:*.esd=01;31:*.jpg=01;35:*.jpeg=01;35:*.mjpg=01;35:*.mjpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.tiff=01;35:*.png=01;35:*.svg=01;35:*.svgz=01;35:*.mng=01;35:*.pcx=01;35:*.mov=01;35:*.mpg=01;35:*.mpeg=01;35:*.m2v=01;35:*.mkv=01;35:*.webm=01;35:*.webp=01;35:*.ogm=01;35:*.mp4=01;35:*.m4v=01;35:*.mp4v=01;35:*.vob=01;35:*.qt=01;35:*.nuv=01;35:*.wmv=01;35:*.asf=01;35:*.rm=01;35:*.rmvb=01;35:*.flc=01;35:*.avi=01;35:*.fli=01;35:*.flv=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:*.xwd=01;35:*.yuv=01;35:*.cgm=01;35:*.emf=01;35:*.ogv=01;35:*.ogx=01;35:*.aac=00;36:*.au=00;36:*.flac=00;36:*.m4a=00;36:*.mid=00;36:*.midi=00;36:*.mka=00;36:*.mp3=00;36:*.mpc=00;36:*.ogg=00;36:*.ra=00;36:*.wav=00;36:*.oga=00;36:*.opus=00;36:*.spx=00;36:*.xspf=00;36:",SDKMAN_DIR:"/home/dimasm/.sdkman",SDKMAN_PLATFORM:"linuxx64",PROJECT_CWD:"/home/dimasm/projects/work-project/reapit-uk/apps",SHELL:"/usr/bin/zsh",npm_package_version:"0.2",npm_lifecycle_event:"build",PWD:"/home/dimasm/projects/work-project/reapit-uk/apps/packages/diary",BERRY_BIN_FOLDER:"/tmp/xfs-1af92607",npm_execpath:"/tmp/xfs-1af92607/yarn",ANDROID_HOME:"/home/dimasm/Android/Sdk",NVM_CD_FLAGS:"-q",HOSTTYPE:"x86_64",WSL2_GUI_APPS_ENABLED:"1",WSLENV:"WT_SESSION::WT_PROFILE_ID",INIT_CWD:"/home/dimasm/projects/work-project/reapit-uk/apps",NODE_ENV:"production"}.APP_STAGE==="production"?"production":"staging",r={"APPLICANT-WIZARD":{staging:pe.stagingDeploymentUrl,production:pe.productionDeploymentUrl},DIARY:{staging:ue.stagingDeploymentUrl,production:ue.productionDeploymentUrl},"MARKET-APPRAISALS":{staging:fe.stagingDeploymentUrl,production:fe.productionDeploymentUrl},"CONTACT-LOOKUP":{staging:be.stagingDeploymentUrl,production:be.productionDeploymentUrl}};return(a=r==null?void 0:r[e])==null?void 0:a[t]},gt=(e,t)=>{var s;const r=un(),a=gn(r),l=mt(e);return hn({queryKey:G.MARKETPLACE_INSTALLATION.paginated(e),fetchWhenTrue:[!!e,!!l,!!a.connectSession],...t,path:`${yn.MARKETPLACE}/installations`,queryParams:{appId:l,clientId:(s=a.connectSession)==null?void 0:s.loginIdentity.clientId,isInstalled:!0}})},ht=e=>{const[t,r]=L.useState(!1),[a,l]=L.useState(!1),s=e??"root",o=()=>r(!0),i=()=>r(!1),c=()=>l(!0),m=()=>l(!1),p=()=>{window.innerWidth>me?o():c()},u=()=>{m(),i()},S=()=>{!t&&!a||(window.innerWidth>me&&a&&(m(),o()),window.innerWidth<me&&t&&(i(),c()))};L.useEffect(()=>(window.addEventListener("resize",S),()=>{window.removeEventListener("resize",S)}),[t,a]);const A=({children:v,modalIsOpen:g=t,drawerIsOpen:k=a,onModalAndDrawerClose:M=()=>{m(),i()},footerItems:I,...N})=>d(qe,{id:s,children:[n(Ye,{isOpen:k,onDrawerClose:M,footerItems:I,...N,children:v}),n(Qe,{isOpen:g,onModalClose:M,...N,children:v})]});return L.useMemo(()=>({ModalAndDrawer:A,closeModalAndDrawer:u,openModalAndDrawer:p,isModalAndDrawerOpen:a||t}),[a,t])},pt=e=>{if(w(e))return Se.orderBy(e,["order"])[0]};var ze={exports:{}};(function(e,t){(function(r,a){e.exports=a()})(je,function(){return function(r,a){var l=a.prototype,s=l.format;l.format=function(o){var i=this,c=this.$locale();if(!this.isValid())return s.bind(this)(o);var m=this.$utils(),p=(o||"YYYY-MM-DDTHH:mm:ssZ").replace(/\[([^\]]+)]|Q|wo|ww|w|WW|W|zzz|z|gggg|GGGG|Do|X|x|k{1,2}|S/g,function(u){switch(u){case"Q":return Math.ceil((i.$M+1)/3);case"Do":return c.ordinal(i.$D);case"gggg":return i.weekYear();case"GGGG":return i.isoWeekYear();case"wo":return c.ordinal(i.week(),"W");case"w":case"ww":return m.s(i.week(),u==="w"?1:2,"0");case"W":case"WW":return m.s(i.isoWeek(),u==="W"?1:2,"0");case"k":case"kk":return m.s(String(i.$H===0?24:i.$H),u==="k"?1:2,"0");case"X":return Math.floor(i.$d.getTime()/1e3);case"x":return i.$d.getTime();case"z":return"["+i.offsetName()+"]";case"zzz":return"["+i.offsetName("long")+"]";default:return u}});return s.bind(this)(p)}}})})(ze);var ft=ze.exports;const bt=Be(ft);re.extend(bt);const St=({propertyData:e})=>{const{selectedMode:t}=Q(),{PhoneContactModal:r,openPhoneContactModal:a}=Tn(),{role:l,primaryContact:s}=Pe(e,t)??{},o=(s==null?void 0:s.name)??Re(s==null?void 0:s.title,s==null?void 0:s.forename,s==null?void 0:s.surname);return d(z,{children:[d(Le,{children:[d(T,{spanDesktop:10,spanWideScreen:12,spanSuperWideScreen:16,span4KScreen:20,children:[n(h,{children:"Property Address"}),n(h,{hasGreyText:!0,hasNoMargin:!0,children:Oe(e==null?void 0:e.address)})]}),d(T,{spanDesktop:3,spanWideScreen:4,spanSuperWideScreen:5,span4KScreen:7,children:[n(h,{children:"Owner Name"}),n(h,{hasGreyText:!0,hasNoMargin:!0,children:o})]}),d(T,{spanDesktop:3,spanWideScreen:4,spanSuperWideScreen:5,span4KScreen:6,children:[n(h,{children:"Owner Role"}),n(h,{hasGreyText:!0,hasNoMargin:!0,children:Cn(l)})]}),d(T,{spanDesktop:4,spanWideScreen:4,spanSuperWideScreen:6,span4KScreen:7,children:[n(h,{children:"Next Call"}),n(h,{hasGreyText:!0,hasNoMargin:!0,children:e!=null&&e.nextCall?re(e==null?void 0:e.nextCall).format("dddd, Do MMMM YYYY"):"-"})]}),w(s)&&w(s==null?void 0:s.email)&&d(T,{spanDesktop:3,spanWideScreen:4,spanSuperWideScreen:5,span4KScreen:7,onClick:()=>window.open(`mailto:${s.email}`,"_blank"),children:[n(h,{children:"Email"}),n(h,{hasGreyText:!0,hasNoMargin:!0,children:s.email})]}),w(s)&&w(s==null?void 0:s.mobilePhone)&&d(T,{spanDesktop:3,spanWideScreen:4,spanSuperWideScreen:5,span4KScreen:6,onClick:()=>a(s.mobilePhone,"mobile"),children:[n(h,{children:"Mobile Phone"}),n(h,{hasGreyText:!0,hasNoMargin:!0,children:s.mobilePhone})]}),w(s)&&w(s==null?void 0:s.homePhone)&&d(T,{spanDesktop:3,spanWideScreen:4,spanSuperWideScreen:6,span4KScreen:7,onClick:()=>a(s.homePhone,"home"),children:[n(h,{children:"Home Phone"}),n(h,{hasGreyText:!0,hasNoMargin:!0,children:s.homePhone})]}),w(s)&&w(s==null?void 0:s.workPhone)&&d(T,{spanDesktop:3,spanWideScreen:4,spanSuperWideScreen:5,span4KScreen:7,onClick:()=>a(s.workPhone,"work"),children:[n(h,{children:"Work Phone"}),n(h,{hasGreyText:!0,hasNoMargin:!0,children:s.workPhone})]})]}),n(r,{})]})};const Pt={primaryImage:"p1gar93n"},At=({propertyData:e})=>{var v;const{isMobile:t,isTablet:r}=Y(),a=Ue(),{ModalAndDrawer:l,openModalAndDrawer:s,closeModalAndDrawer:o}=ht(),{selectedMode:i}=Q(),{primaryContact:c}=Pe(e,i)??{},m=pt((v=e==null?void 0:e._embedded)==null?void 0:v.images),p=Oe(H.pick(e==null?void 0:e.address,["line1","line2"])),u=(c==null?void 0:c.name)??Re(c==null?void 0:c.title,c==null?void 0:c.forename,c==null?void 0:c.surname),S=t||r,A=g=>{g.preventDefault(),a(`/${e.id}/images`)};return d(z,{children:[d(O,{isFlexJustifyBetween:!0,isFlexColumn:S,className:"el-mb5 el-col-gap8","data-testid":"header-section-container",children:[S?n(Ke,{"data-testid":"mobile-header-owner-container",onClick:s,children:d(Je,{children:[n(Ze,{children:n(Me,{icon:"houseInfographic"})}),d(De,{children:[n(Xe,{"data-testid":"mobile-header-property-short-address",children:p}),n(en,{"data-testid":"mobile-header-property-owner-name",children:u})]})]})}):d(O,{isFlexColumn:!0,"data-testid":"header-owner-section",children:[d("div",{children:[n(Ee,{hasNoMargin:!0,"data-testid":"header-property-short-address",children:p}),n(ye,{"data-testid":"header-property-owner-name",children:u})]}),n(oe,{children:n(j,{className:"el-mt2",intent:"primary",buttonSize:"large","data-testid":"header-property-owner-button",onClick:s,children:"Details"})})]}),n("div",{className:nn(S&&"el-my5"),"data-testid":"header-hero-primary-property-image-container",children:w(m)?n(In,{"data-testid":"header-hero-primary-image",className:Pt.primaryImage,src:m.url,onClick:A,fallbackComponent:n(Ce,{"data-testid":"header-hero-primary-image-loading-fallback",placeholder:"placeholderSmall",size:250,fillAvailable:!0})}):n("a",{href:"#",onClick:A,children:n(Ce,{onClick:A,"data-testid":"header-hero-primary-image-not-found-fallback",placeholder:"placeholderLarge",size:250,fillAvailable:!0})})})]}),n(l,{title:"Details",footerItems:n(oe,{alignment:"right",children:n(j,{intent:"default",onClick:o,children:"Close"})}),children:n(St,{propertyData:e})})]})},Ie=e=>{const t=pn(),{success:r}=tn(),{selectedMode:a}=Q(),{primaryContact:l}=Pe(e,a)??{},s=e==null?void 0:e.id,o=l==null?void 0:l.id,i=t.getQueryData(G.PROPERTY.single(e==null?void 0:e.id)),c=t.getQueryData(G.CONTACT.single(o)),m=t.getQueryData(G.COMPANY.single(o)),[p,,,{isLoading:u,isSuccess:S}]=Sn(s,{onSuccess:R=>{t.setQueryData(G.PROPERTY.single(s),{...R,_embedded:i==null?void 0:i._embedded})},successMessage:"Property Updated"}),[A,,,{isLoading:v,isSuccess:g}]=Pn(s,{headers:{"If-Match":i==null?void 0:i._eTag}}),[k,,,{isLoading:M,isSuccess:I}]=Un(o,{onSuccess:R=>{var Z,D,X,ee;const W=R,ce=a==="selling",de=a==="letting",K=ce?se({type:"vendor",data:(Z=i==null?void 0:i._embedded)==null?void 0:Z.vendor},{type:"contact",data:W}):(D=i==null?void 0:i._embedded)==null?void 0:D.vendor,J=de?se({type:"landlord",data:(X=i==null?void 0:i._embedded)==null?void 0:X.landlord},{type:"contact",data:W}):(ee=i==null?void 0:i._embedded)==null?void 0:ee.landlord;t.setQueryData(G.PROPERTY.single(s),{...i,_embedded:{...i==null?void 0:i._embedded,...K&&{vendor:K},...J&&{landlord:J}}}),t.setQueryData(G.CONTACT.single(o),{...W,_embedded:c==null?void 0:c._embedded})}}),[N,,,{isLoading:f,isSuccess:U}]=xn(o,{headers:{"If-Match":c==null?void 0:c._eTag}}),[x,,,{isLoading:b,isSuccess:E}]=Fn(o,{onSuccess:R=>{var Z,D,X,ee;const W=R,ce=a==="selling",de=a==="letting",K=ce?se({type:"vendor",data:(Z=i==null?void 0:i._embedded)==null?void 0:Z.vendor},{type:"company",data:W}):(D=i==null?void 0:i._embedded)==null?void 0:D.vendor,J=de?se({type:"landlord",data:(X=i==null?void 0:i._embedded)==null?void 0:X.landlord},{type:"company",data:W}):(ee=i==null?void 0:i._embedded)==null?void 0:ee.landlord;t.setQueryData(G.PROPERTY.single(s),{...i,_embedded:{...i==null?void 0:i._embedded,...K&&{vendor:K},...J&&{landlord:J}}}),t.setQueryData(G.COMPANY.single(o),{...W,_embedded:m==null?void 0:m._embedded})}}),[y,,,{isLoading:C,isSuccess:F}]=kn(o,{headers:{"If-Match":m==null?void 0:m._eTag}});return{updateProperty:async R=>{await A(R),await p({})},updateContact:async(R,W=!1)=>{await N(R),await k({}),!W&&r("Property Updated")},updateCompany:async(R,W=!1)=>{await y(R),await x({}),!W&&r("Property Updated")},isLoading:f||C||v||M||b||u,isSuccess:U||F||g||I||E||S}},se=(e,t)=>{var a,l,s,o,i;if(!e||!t)return e==null?void 0:e.data;const r=[...((a=e==null?void 0:e.data)==null?void 0:a.related)??[]];return r.length>0&&(r[0]={...r[0],...(t==null?void 0:t.type)==="contact"&&{homePhone:(l=t==null?void 0:t.data)==null?void 0:l.homePhone},workPhone:(s=t==null?void 0:t.data)==null?void 0:s.workPhone,mobilePhone:(o=t==null?void 0:t.data)==null?void 0:o.mobilePhone,email:(i=t==null?void 0:t.data)==null?void 0:i.email}),{...e==null?void 0:e.data,related:r}},te=(e=0,t=0)=>{if(e&&!t)return`${e}`;if(!e&&t)return`${t}`;if(e===t)return`${t}`;if(e&&t)return`${e} to ${t}`},vt=({propertyData:e})=>{var N,f,U,x,b,E,y,C,F;const{bedrooms:t,bedroomsMax:r,bathrooms:a,bathroomsMax:l,receptions:s,receptionsMax:o,strapline:i,description:c,notes:m,style:p,type:u}=e,S=p!=null&&p.length?p.map($=>Ne.STYLE[$]):[],A=u!=null&&u.length?u.map($=>Ne.TYPE[$]):[],{register:v,getValues:g}=Ae(),{updateProperty:k}=Ie(e),{selectedMode:M}=Q(),I=L.useMemo(()=>H.debounce(async()=>{const $=g();await k($)},ve),[]);return d(z,{children:[d(Le,{children:[M==="selling"&&d(z,{children:[n(T,{spanMobile:2,spanTablet:2,spanDesktop:2,spanWideScreen:3,children:d(O,{isFlexColumn:!0,"data-testid":"selling-price-and-qualifier",children:[n(h,{children:(N=e==null?void 0:e.selling)!=null&&N.qualifier?_n[(f=e==null?void 0:e.selling)==null?void 0:f.qualifier]:"Property Price"}),n(h,{hasGreyText:!0,hasNoMargin:!0,children:le((U=e==null?void 0:e.selling)==null?void 0:U.price)})]})}),n(T,{spanMobile:2,spanTablet:2,spanDesktop:2,spanWideScreen:3,children:d(O,{isFlexColumn:!0,"data-testid":"property-selling-status",children:[n(h,{children:"Property Status"}),n(h,{hasGreyText:!0,hasNoMargin:!0,children:(x=e==null?void 0:e.selling)!=null&&x.status?Nn[e==null?void 0:e.selling.status]:"-"})]})})]}),M==="letting"&&d(z,{children:[n(T,{spanMobile:2,spanTablet:2,spanDesktop:2,spanWideScreen:3,children:d(O,{isFlexColumn:!0,"data-testid":"letting-price-qualifier-and-frequency",children:[d(h,{children:[(b=e==null?void 0:e.letting)!=null&&b.qualifier?wn[(E=e==null?void 0:e.letting)==null?void 0:E.qualifier].concat(" "):"Rent ",(y=e.letting)!=null&&y.rentFrequency?Ln[e.letting.rentFrequency]:""]}),n(h,{hasGreyText:!0,hasNoMargin:!0,children:le((C=e==null?void 0:e.letting)==null?void 0:C.rent)})]})}),n(T,{spanMobile:2,spanTablet:2,spanDesktop:2,spanWideScreen:3,children:d(O,{isFlexColumn:!0,"data-testid":"property-letting-status",children:[n(h,{children:"Property Status"}),n(h,{hasGreyText:!0,hasNoMargin:!0,children:(F=e==null?void 0:e.letting)!=null&&F.status?Mn[e==null?void 0:e.letting.status]:"-"})]})})]}),n(T,{spanMobile:2,spanTablet:2,spanDesktop:2,spanWideScreen:3,children:d(O,{isFlexColumn:!0,"data-testid":"property-bedroom",children:[n(h,{children:"Bedrooms"}),n(h,{hasGreyText:!0,hasNoMargin:!0,children:te(t,r)})]})}),n(T,{spanMobile:2,spanTablet:2,spanDesktop:2,spanWideScreen:3,children:d(O,{isFlexColumn:!0,"data-testid":"property-bathroom",children:[n(h,{children:"Bathrooms"}),n(h,{hasGreyText:!0,hasNoMargin:!0,children:te(a,l)})]})}),n(T,{spanMobile:2,spanTablet:2,spanDesktop:2,spanWideScreen:3,children:d(O,{isFlexColumn:!0,"data-testid":"property-reception",children:[n(h,{children:"Reception Rooms"}),n(h,{hasGreyText:!0,hasNoMargin:!0,children:te(s,o)})]})}),n(T,{spanMobile:2,spanTablet:2,spanDesktop:2,spanWideScreen:3,children:d(O,{isFlexColumn:!0,"data-testid":"property-style-and-type",children:[n(h,{children:"Property Type"}),n(h,{hasGreyText:!0,hasNoMargin:!0,children:S.concat(A).length?S.concat(A).join(", "):"-"})]})})]}),d(O,{isFlexColumn:!0,children:[d("div",{className:"el-mt8",children:[n(h,{children:"Notes"}),n(ae,{children:n(_,{children:n(Te,{"data-testid":"property-notes",defaultValue:m,...v("notes",{onChange:I}),placeholder:"Notes"})})})]}),d("div",{className:"el-mt8",children:[n(h,{children:"Description"}),n(sn,{children:n(P,{className:"el-mb8",children:n(_,{"data-testid":"property-description-title",...v("strapline",{onChange:I}),defaultValue:i,placeholder:"Title"})})}),n(ae,{children:n(_,{children:n(Te,{"data-testid":"property-description",...v("description",{onChange:I}),defaultValue:c,placeholder:"Description"})})})]})]})]})},It=q().shape({serviceCharge:ie().transform((e,t)=>!w(e)||isNaN(e)?0:+t).min(-1,V.HIGHER_OR_EQUAL_THAN("Letting Service","0")),letting:q().shape({lettingFee:q().shape({amount:ie().transform((e,t)=>!w(e)||isNaN(e)?0:+t).min(-1,V.HIGHER_OR_EQUAL_THAN("Letting Fee","0")).when("type",{is:"percentage",then:e=>e.max(100,V.LOWER_OR_EQUAL_THAN("Letting Fee","100"))})}),managementFee:q().shape({amount:ie().transform((e,t)=>!w(e)||isNaN(e)?0:+t).min(-1,V.HIGHER_OR_EQUAL_THAN("Management Fee","0")).when("type",{is:"percentage",then:e=>e.max(100,V.LOWER_OR_EQUAL_THAN("Management Fee","100"))})})})}),Ct=["letting.lettingFee.amount","letting.lettingFee.type","letting.managementFee.amount","letting.managementFee.type","letting.availableFrom","letting.availableTo","serviceCharge","letting.instructed","valuation","selling.recommendedPrice","selling.agencyId","selling.disposal","selling.fee.amount","selling.fee.type"],$e=e=>t=>{const r=t.target.name;Ct.includes(r)&&e()},He=e=>({...Se.omit(e,["localFields","metadata","_eTag","_embedded"])});function Tt({propertyData:e}){var N,f,U,x,b,E,y;const{register:t,reset:r,setValue:a,watch:l,formState:s,getValues:o,trigger:i,control:c}=Ae({defaultValues:e,resolver:Ge(It),mode:"all"}),{isWideScreen:m,isSuperWideScreen:p,is4KScreen:u}=Y(),S=m||p||u?P:ae,{updateProperty:A}=Ie(e),{dispatch:v}=We({timeout:ve,onDebounce:C=>{Object.keys(s.errors).length||A(He(C))}}),g=C=>{const F=C.target.name.replace(/\.type$/,"");C.target.value==="percentage"&&a(`${F}.amount`,0),i(`${F}.amount`)},k=C=>{const F=C.target.name.replace(/\.amount$/,"");o(`${F}.type`)||a(`${F}.type`,"percentage")};L.useEffect(()=>{var C,F;e&&(r(e),a("letting.lettingFee.type",(F=(C=e.letting)==null?void 0:C.lettingFee)==null?void 0:F.type))},[e]);const M=l("letting.lettingFee.type")==="percentage",I=l("letting.managementFee.type")==="percentage";return n("form",{onChange:$e(()=>v(o())),children:d(Fe,{children:[n(P,{children:n(_,{type:"date",label:"Available From","data-testid":"available-from",max:l("letting.availableTo"),...t("letting.availableFrom")})}),n(P,{children:n(_,{type:"date",label:"Available To","data-testid":"available-to",min:l("letting.availableFrom"),...t("letting.availableTo")})}),n(S,{children:n(ne,{label:"Letting Service","data-testid":"letting-service",control:c,name:"serviceCharge",errorMessage:(N=s.errors.serviceCharge)==null?void 0:N.message})}),n(P,{children:n(ne,{control:c,label:"Letting Fee","data-testid":"letting-fee",onChange:k,name:"letting.lettingFee.amount",errorMessage:(x=(U=(f=s.errors.letting)==null?void 0:f.lettingFee)==null?void 0:U.amount)==null?void 0:x.message})}),n(P,{children:d(_,{children:[n(B,{children:"Use Percentage Letting Fee"}),n(ge,{"data-testid":"letting-fee-toggle",...t("letting.lettingFee.type",{onChange:g}),options:[{id:"yes-use-lettingFee-percentage",value:"percentage",text:"Yes",isChecked:M},{id:"not-use-lettingFee-percentage",value:"fixed",text:"No",isChecked:!M}]})]})}),n(P,{children:n(ne,{control:c,label:"Management Fee","data-testid":"management-fee",onChange:k,name:"letting.managementFee.amount",errorMessage:(y=(E=(b=s.errors.letting)==null?void 0:b.managementFee)==null?void 0:E.amount)==null?void 0:y.message})}),n(P,{children:d(_,{children:[n(B,{children:"Use Percentage Management Fee"}),n(ge,{"data-testid":"management-fee-toggle",...t("letting.managementFee.type",{onChange:g}),options:[{id:"yes-use-managementFee-percentage",value:"percentage",text:"Yes",isChecked:I},{id:"not-use-managementFee-percentage",value:"fixed",text:"No",isChecked:!I}]})]})}),n(P,{children:d(_,{children:[n(B,{children:"Letting Agency"}),n(he,{children:n("option",{value:"",children:"Select Agency"})})]})}),n(P,{children:n(_,{type:"date",label:"Date Instructed","data-testid":"date-instructed",...t("letting.instructed")})}),n(P,{className:"el-mb5",children:n(_,{type:"date",label:"MA Date","data-testid":"ma-date",...t("valuation")})})]})})}const _t=q().shape({selling:q().shape({fee:q().shape({amount:ie().transform((e,t)=>!w(e)||isNaN(e)?0:+t).min(-1,V.HIGHER_OR_EQUAL_THAN("Commision amount","0")).when("type",{is:"percentage",then:e=>e.max(100,V.LOWER_OR_EQUAL_THAN("Commision amount","100"))})})})});function Nt({propertyData:e}){var N,f,U,x;const[t]=xe(),{register:r,reset:a,watch:l,setValue:s,getValues:o,formState:i,trigger:c,control:m}=Ae({defaultValues:e,resolver:Ge(_t),mode:"all"}),{isWideScreen:p,isSuperWideScreen:u,is4KScreen:S}=Y(),A=p||u||S?P:ae,{updateProperty:v}=Ie(e),{dispatch:g}=We({timeout:ve,onDebounce:b=>{Object.keys(i.errors).length||v(He(b))}}),k=b=>{b.target.value==="percentage"?s("selling.fee.amount",0):s("selling.fee.amount",Math.round(o("selling.fee.amount")??0)),c("selling.fee.amount")},M=()=>{o("selling.fee.type")||s("selling.fee.type","percentage")};L.useEffect(()=>{e&&a(e)},[e]);const I=l("selling.fee.type")==="percentage";return n("form",{onChange:$e(()=>g(o())),children:d(Fe,{children:[n(A,{children:n(ne,{control:m,"data-testid":"vendor-price",label:"Vendor Price",name:"selling.recommendedPrice"})}),n(P,{children:n(_,{type:"number",onChange:()=>{},value:0,label:"MA Price From"})}),n(P,{children:n(_,{type:"number",onChange:()=>{},value:0,label:"MA Price To"})}),n(P,{children:n(_,{type:"date",label:"MA Date","data-testid":"ma-date",...r("valuation")})}),n(P,{children:d(_,{children:[n(B,{children:"Selling Agency"}),d(he,{"data-testid":"selling-agency",...r("selling.agencyId"),children:[n("option",{disabled:!!l("selling.agencyId"),value:"",children:"Select Agency"}),(N=t==null?void 0:t.agencyTypes)==null?void 0:N.map(({id:b,value:E})=>n("option",{value:b,children:E},b))]})]})}),n(A,{children:d(_,{children:[n(B,{children:"Disposal"}),d(he,{"data-testid":"disposal",...r("selling.disposal"),children:[n("option",{disabled:!!l("selling.disposal"),value:"",children:"Select appointment type"}),Object.entries(En).map(([b,E])=>n("option",{value:b,children:E},b))]})]})}),n(P,{children:n(ne,{control:m,allowDecimal:I,label:"Commision",name:"selling.fee.amount",onChange:M,errorMessage:(x=(U=(f=i.errors.selling)==null?void 0:f.fee)==null?void 0:U.amount)==null?void 0:x.message,"data-testid":"commision"})}),n(P,{children:d(_,{children:[n(B,{children:"Use Percentage Commision"}),n(ge,{"data-testid":"commisionTypeToggle",...r("selling.fee.type",{onChange:k}),options:[{id:"yes-use-sellingFee-percentage",value:"percentage",text:"Yes",isChecked:I},{id:"not-use-sellingFee-percentage",value:"fixed",text:"No",isChecked:!I}]})]})})]})})}const Ve=e=>!e||!re(e).isValid()?"-":re(e).format(On),wt=e=>{const{isMobile:t,isTablet:r}=Y();return e.map(a=>{var m;const{address:l,bedrooms:s,selling:o,bedroomsMax:i}=a,c=(o==null?void 0:o.status)==="exchanged"?"Exchanged Date":"Completed Date";return{cells:[{label:"Address",value:(l==null?void 0:l.line1)??"-",icon:r||t?"houseInfographic":void 0,narrowTable:{showLabel:!0,order:1}},{label:"Bedrooms",value:te(s,i),icon:r||t?"houseInfographic":void 0,narrowTable:{showLabel:!0,order:1}},{label:t||r?c:"Date Property Changed",value:Ve((m=a==null?void 0:a.localFields)==null?void 0:m.journalEntryCreated),icon:r||t?"calendarSolidSystem":void 0,narrowTable:{showLabel:!0,order:1}},{label:"Sold Price",value:le(o==null?void 0:o.exchangedPrice),icon:r||t?"poundSolidSystem":void 0,narrowTable:{showLabel:!0,order:1}}]}})},Lt=e=>{const{isMobile:t,isTablet:r}=Y();return e.map(a=>{var c;const{address:l,bedrooms:s,letting:o,bedroomsMax:i}=a;return{cells:[{label:"House Number",value:(l==null?void 0:l.buildingNumber)??"-",icon:r||t?"houseInfographic":void 0,narrowTable:{showLabel:!0,order:1}},{label:"Address",value:(l==null?void 0:l.line1)??"-",icon:r||t?"houseInfographic":void 0,narrowTable:{showLabel:!0,order:1}},{label:"Bedrooms",value:te(s,i),icon:r||t?"houseInfographic":void 0,narrowTable:{showLabel:!0,order:1}},{label:"Rent Amount",value:le(o==null?void 0:o.rent),icon:r||t?"poundSolidSystem":void 0,narrowTable:{showLabel:!0,order:1}},{label:"Rent Frequency",value:o!=null&&o.rentFrequency?Se.capitalize(o==null?void 0:o.rentFrequency):"-",icon:r||t?"houseInfographic":void 0,narrowTable:{showLabel:!0,order:1}},{label:"Start Date",value:Ve((c=a==null?void 0:a.localFields)==null?void 0:c.journalEntryCreated),icon:r||t?"calendarSolidSystem":void 0,narrowTable:{showLabel:!0,order:1}}]}})},Mt=({postCode:e,marketingMode:t,currentPropertyId:r})=>{const[a,l]=L.useState(1),[s,o]=L.useState([]),[i,c]=L.useState(1),[m,p]=L.useState([]),[u,S]=L.useState([]),A=t==="selling"?{sellingStatus:["exchanged","completed"]}:{lettingStatus:["tenancyCurrent","tenancyFinished"]},v=t==="selling"?["SC","SX"]:["LC","LF"],[g,k,{isLoading:M,isFetching:I,isError:N}]=An({queryParams:{address:e,marketingMode:t,...A,pageNumber:i},fetchWhenTrue:[e&&t]});L.useEffect(()=>{if(g!=null&&g.pageNumber&&(g!=null&&g.totalPageCount)&&g.pageNumber<g.totalPageCount&&c((g==null?void 0:g.pageNumber)+1),g!=null&&g._embedded&&p(y=>y.concat(g._embedded)),i===(g==null?void 0:g.totalPageCount)&&(g!=null&&g._embedded)){const y=[...m,...g._embedded].map(C=>C.id);S(H.uniq(y))}},[g]);const[f,U,{isLoading:x,isFetching:b,isError:E}]=Rn({queryParams:{typeId:v,propertyId:u,pageNumber:a,sortBy:"-created"},fetchWhenTrue:[u==null?void 0:u.length]});return L.useEffect(()=>{f!=null&&f.pageNumber&&(f!=null&&f.totalPageCount)&&f.pageNumber<f.totalPageCount&&l((f==null?void 0:f.pageNumber)+1),f!=null&&f._embedded&&o(y=>y.concat(f._embedded))},[f]),{data:Et({propertiesData:m,journalEntriesData:s,marketingMode:t,currentPropertyId:r}),isLoading:M||x,isFetching:I||b,isError:N||E,error:k||U}},Et=({propertiesData:e,journalEntriesData:t,marketingMode:r,currentPropertyId:a})=>{if(!(e!=null&&e.length)||!(t!=null&&t.length))return null;const l=Array.from(new Set(t.map(m=>m.propertyId))),s=yt(t),o=e.filter(m=>m.id!==a),i=H.uniqBy(o,"id").reduce((m,p)=>{if(l.includes(p.id)){const u=H.find(s,["propertyId",p.id]);return r==="selling"?m.push({...p,localFields:{journalEntryCreated:u==null?void 0:u.created,journalEntryTypeId:u==null?void 0:u.typeId}}):m.push({...p,localFields:{journalEntryCreated:u==null?void 0:u.created,journalEntryTypeId:u==null?void 0:u.typeId}}),m}return m},[]);return H.orderBy(i,["localFields.journalEntryCreated"],["desc"])},yt=e=>H.uniqBy(e,"propertyId"),Ft=({propertyData:e})=>{const{isMobile:t,isTablet:r}=Y(),{selectedMode:a}=Q(),{address:l,id:s}=e,{data:o,isLoading:i,isFetching:c,isError:m,error:p}=Mt({postCode:l==null?void 0:l.postcode,marketingMode:a,currentPropertyId:s});return l!=null&&l.postcode?d("div",{children:[n(ye,{hasBoldText:!0,"data-testid":"recently-sold-or-let-title",children:a==="selling"?"Recently Sold Properties":"Recently Let Properties"}),c||i?n(ke,{}):m?n(_e,{"data-testid":"recently-sold-or-rent-error-notification",isExpanded:!0,isFullWidth:t||r,intent:"danger",children:(p==null?void 0:p.readableMessage)||fn.DEFAULT}):o&&(o!=null&&o.length)?n(on,{"data-testid":"recently-sold-or-let-properties",rows:a==="selling"?wt(o):Lt(o)}):n(_e,{"data-testid":"recently-sold-or-rent-not-found-notification",className:"el-mt8",isExpanded:!0,intent:"default",isInline:!0,isFullWidth:t||r,children:"No Data Found!"})]}):n(z,{})},we=({propertyData:e,selectedTab:t})=>{const r=Ue(),{selectedMode:a,hasMultipleMode:l,switchMode:s}=Q(e),[o]=gt("DIARY"),i=(o==null?void 0:o.pageCount)!==0;return d(z,{children:[n(Me,{"data-testid":"controls-icon",className:"el-mb5",icon:"propertyManagementInfographic",iconSize:"large"}),n(an,{"data-testid":"controls-description",hasGreyText:!0,children:"This app provides the tools required to document the outcome of a market appraisal appointment and make changes to an existing property record."}),d(oe,{"data-testid":"controls-button-group",children:[t==="summary"&&d(z,{children:[n(j,{"data-testid":"controls-button-edit",intent:"primary",onClick:()=>r(`/${e==null?void 0:e.id}/edit`),children:"Edit"}),i&&n(j,{onClick:()=>{const m={confirmation:{includeProperty:!0,includeAttendee:null},appointment:{id:"random-appointment",propertyId:e==null?void 0:e.id,_embedded:{property:e}}},p=new URLSearchParams(H.mapValues(m,u=>JSON.stringify(u)));window.open(`${ut("DIARY")}/create?${p.toString()}`,"_blank")},"data-testid":"controls-button-create-appointment",intent:"primary",children:"Create Appointment"})]}),l&&d(j,{"data-testid":"controls-button-switch-mode",intent:"primary",onClick:s,children:["Switch to ",a==="selling"?"Rent":"Sales"]})]})]})},kt=()=>{const{isMobile:e}=Y(),{propertyId:t}=bn(),{Modal:r,openModal:a,closeModal:l}=rn(),[s,o]=L.useState("summary"),[,,{isLoading:i}]=xe(),[c,,{isLoading:m}]=vn(t,{fetchWhenTrue:[!!t],queryParams:{embed:["landlord","vendor","images"]}}),{selectedMode:p}=Q(c);return d(O,{isFlexGrow1:!0,children:[d(ln,{children:[n(Ee,{children:"Market Appraisals"}),n(we,{selectedTab:s,propertyData:c})]}),n(cn,{"data-testid":"view-property-page-container",children:m||i?n(ke,{fullPage:!0,"data-testid":"view-property-loader"}):w(c)&&d(z,{children:[e&&d(r,{title:"Controls",children:[n(we,{selectedTab:s,propertyData:c}),n(oe,{alignment:"center",className:"el-mt5",children:n(j,{intent:"default",onClick:l,children:"Close"})})]}),n(At,{propertyData:c}),d("div",{className:"el-mb12",children:[n(dn,{name:"view-property-tab",isFullWidth:!0,options:[{id:"summary",value:"summary",text:"Summary",isChecked:s==="summary"},{id:"pricing",value:"pricing",text:"Pricing",isChecked:s==="pricing"},{id:"valuation",value:"valuation",text:"Valuation",isChecked:s==="valuation"}],onChange:S=>o(S.currentTarget.value)}),s==="summary"&&n(vt,{propertyData:c}),s==="pricing"&&(p==="selling"?n(Nt,{propertyData:c}):n(Tt,{propertyData:c})),s==="valuation"&&n(Ft,{propertyData:c})]}),n(mn,{onClick:a})]})})]})},rs=kt;export{rs as default};
