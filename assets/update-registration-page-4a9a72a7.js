import{j as c,a as v,F as Q}from"./index-154d360c.js";import{d as ee,I as te,r as p,h as se,e as H,ad as oe,O as re,K as ae}from"./elements-7fcf5525.js";import{o as ne}from"./index.esm-c689e26d.js";import{u as ie,F as ce}from"./index.esm-70abc844.js";import{m as w,e as de,o as le,j as d,t as ue}from"./app-071066e2.js";import{c as me,u as pe,a as ge,S as fe,F as he,s as j,b as Se,v as Ae,A as Ee}from"./progress-bar-v2-4abe047d.js";import{P as Fe}from"./page-layout-cd2512b9.js";import{b as Ie,c as be}from"./get-single-applicant-79b5734c.js";import"./axios-12d950d5.js";import{u as Te,a as Ce}from"./hooks-e028e56e.js";import{u as Pe}from"./use-get-admin-setup-metadata-0f0db25b.js";import{u as ve,a as ye}from"./scroll-to-bottom-fab-d82a7cd6.js";import{D as Me}from"./error-messages-27b293ab.js";import"./extended-yup-validation-f272edd3.js";import"./regex-aa179d17.js";import"./options-21b6589e.js";import"./input-error-ab59bffb.js";import"./department-mapping-99823d46.js";import"./index-43613dd1.js";import"./use-user-agent-7653ecfd.js";import"./generate-1a9ed554.js";import"./routes-4ccd8c9c.js";import"./queries-keys-1e9a6485.js";import"./middleware-a8d06d07.js";const Le=["id","title","forename","surname","marketingConsent","homePhone","workPhone","mobilePhone","email","primaryAddress"],Ve=n=>w.pick(n,Le),Oe=["related","unmappedRequirements","_eTag","_embedded","_links","created","modified","fromArchive","metadata","commercial","lastCall","negotiatorIds","officeIds","regional","solicitorId","source","active","archivedOn","currency","nextCall"],Re=(n,g)=>{var l,E;const s=w.omit(n||g,Oe),u={};(s==null?void 0:s.externalArea)===null&&(u.externalArea={amountFrom:null,amountTo:null}),(s==null?void 0:s.internalArea)===null&&(u.internalArea={type:null,amount:null});const a=(l=s==null?void 0:s.buying)==null?void 0:l.leaseRemaining;return(a==null?void 0:a.min)===0&&(a==null?void 0:a.max)===0&&(s.buying.leaseRemaining=void 0),((E=s==null?void 0:s.renting)==null?void 0:E.moveDate)==="0001-01-01T00:01:00Z"&&(s.renting.moveDate=""),{...s,...u}},ot=()=>{var R,_,k,G;const{applicantId:n}=de(),[g,s]=ee.useState("4"),{isMobile:u,isTablet:a}=te(),l=ve(),E=ye(),{setTailoredQuestions:B}=Te(),{setStepsHeader:U}=Ce(),[o,W]=p.useState(l.formData),{removePopStateListener:D}=le(),y=me(),b=pe(),T=ge(),t=Pe(),{data:e,isError:q,isFetching:K,error:F}=Ie(n,{enabled:!!n,staleTime:0,refetchOnMount:!(o!=null&&o.applicant.id)}),[M,X]=p.useState((R=o==null?void 0:o.contact)==null?void 0:R.id),{data:L,isError:Z,isFetching:z,error:C}=be(M,{enabled:!!M,staleTime:0}),i={contact:Ve(L),applicant:Re(e)},r=ie({mode:"all",defaultValues:i,resolver:ne(Ee)});p.useEffect(()=>{l.formData&&(W(l.formData),E.resetStoresValues(),D("summary"))},[l.formData]),p.useEffect(()=>{var m,f;d(e)&&d(e==null?void 0:e.related)&&d((m=e==null?void 0:e.related)==null?void 0:m[0])&&X((f=e==null?void 0:e.related)==null?void 0:f[0].id),!d(o==null?void 0:o.choosenArea)&&d(e)&&(e==null?void 0:e.locationType)==="areas"&&d(e==null?void 0:e.locationOptions)&&y.mutate(e.locationOptions??[],{onSuccess:h=>{var S;if((S=h._embedded)!=null&&S.length){const I=h._embedded.map(A=>({name:A.name,value:A.id}));r.setValue("choosenArea",I)}}})},[e]),p.useEffect(()=>{(()=>{if(o){r.reset(),r.reset(o,{keepDefaultValues:!0});return}d(i==null?void 0:i.applicant)&&d(i==null?void 0:i.contact)&&r.reset({...r.getValues(),...i},{keepDefaultValues:!1})})()},[L,e,o]),p.useEffect(()=>{var m,f,h,S,I,A,N,x;if((f=(m=t==null?void 0:t.data)==null?void 0:m.metadata)!=null&&f.tailoredQuestions){const P=(S=(h=t==null?void 0:t.data)==null?void 0:h.metadata)==null?void 0:S.tailoredQuestions;B(P)}if((A=(I=t==null?void 0:t.data)==null?void 0:I.metadata)!=null&&A.stepsHeader){const P=(x=(N=t==null?void 0:t.data)==null?void 0:N.metadata)==null?void 0:x.stepsHeader;U(P)}},[t==null?void 0:t.isLoading]);const V=r.watch("contact.primaryAddress.countryId"),J=o!=null&&o.applicant.id&&V?V==((_=o.contact.primaryAddress)==null?void 0:_.countryId)||r.getFieldState("contact.primaryAddress.countryId").isDirty:!!r.watch("applicant.id")&&!!r.watch("contact.id"),Y=b.isLoading||T.isLoading||K||z||y.isLoading||(t==null?void 0:t.isLoading),O=q||Z||b.isError||T.isError,$=O?((k=b.error)==null?void 0:k.readableMessage)??((G=T.error)==null?void 0:G.readableMessage)??(F==null?void 0:F.readableMessage)??(C==null?void 0:C.readableMessage)??Me.DEFAULT:"";return c(Fe,{prefixTestId:"rp",children:Y?c(se,{label:"Loading",fullPage:!0}):O?F instanceof ue?v(H,{isInline:!0,isExpanded:!0,isFullWidth:u||a,intent:"danger",children:["Data with id ",n," is not found!"]}):c(H,{isInline:!0,isExpanded:!0,isFullWidth:u||a,intent:"danger",className:oe,children:$}):J&&v(Q,{children:[v("div",{className:fe,children:[c(re,{children:"Update Registration"}),c(he,{currentStep:+g,totalStep:j.length,"data-testid":"rp-progress-bar"})]}),c("form",{className:Se,onChange:Ae({getValues:r.getValues,trigger:r.trigger,stepState:[g,s]}),"data-testid":"rp-form",children:c(ce,{...r,children:c(ae,{steps:j,selectedStep:g})})})]})})};export{ot as default};
