import{j as t,F as g,a as N}from"./index-b3f50da9.js";import{r as s,i as V,f as R,O as W,C as j,e as S,h as H,ax as q}from"./elements-7fcf5525.js";import{j as F,a1 as G,H as Y,u as D,V as U,W as $}from"./app-1088c2df.js";import{c as Q}from"./index-8f0c1425.js";import{a as z}from"./index-230a9ce9.js";import{u as J}from"./index-03f71f46.js";import{M as K}from"./modal-dialog-0e8fb4f7.js";import{S as M}from"./index-35dae0a4.js";import{u as X}from"./use-frequently-appointment-update-895837db.js";import{e as Z}from"./index-afe42bc9.js";import{F as ee}from"./feedback-button-10b39ca0.js";import"./url-ce1d32f5.js";import"./index.esm-70abc844.js";import"./helper-ac9457cc.js";import"./index-fa19f396.js";import"./index-c5c95794.js";import"./property-owner-1850ad04.js";import"./index-706e92ed.js";import"./with-plugins-a1c7cafe.js";import"./isBetween-bb99a4b7.js";import"./isSameOrAfter-571fd34c.js";import"./index-6d471c01.js";const te=a=>{const[i,p]=s.useState([]);return{clearData:()=>p([]),data:s.useMemo(()=>{if(F(a)&&F(a==null?void 0:a._embedded)){const c=a._embedded.filter(r=>r.marketingMode!=="sellingAndLetting"),d=G.uniqBy([...i,...c],"id");return p(d),d}return i},[a])}},Me=({appointmentId:a})=>{const i="extended-change-property-appointment",{trackEvent:p}=Y(),h=D(),[c,d]=s.useState(!1),[r,m]=s.useState({pageNumber:1,sortBy:"-created",marketingMode:["selling"],embed:["landlord","vendor"]}),[o,u,{isLoading:E,isError:I,isFetching:T,isSuccess:x}]=z({queryParams:r,fetchWhenTrue:[!!(r!=null&&r.address)]}),{data:f,clearData:y}=te(o),{ref:A,inView:b}=J(),P=V("root"),[n,C]=s.useState(null),{update:k,isLoading:L}=X(a),O=async e=>{const l=e.currentTarget,B=202;l.scrollTop>B?d(!0):d(!1)},_=()=>{const e=document.getElementById(i);e==null||e.scroll({top:0,behavior:"smooth"})},v=async()=>{p(U.INTERACTION_SECTION,{...$("DIARY"),Name:"Linked property on the appointment has been changed",Action:"Confirm the change property button","Event Type":"Click"})(),await k({propertyId:n==null?void 0:n.id,propertyConfirmed:!1}),C(null),h({pathname:`/${a}`},{replace:!0})},w=()=>{(o==null?void 0:o.totalPageCount)===r.pageNumber||E||T||m(e=>({...e,pageNumber:e.pageNumber+1}))};return s.useEffect(()=>{b&&w()},[b]),t(g,{children:N(R,{id:i,"data-testid":"extended-change-property-appointment",onScroll:O,children:[t(W,{"data-testid":"title-change-property",children:"Select New Property"}),t(j,{"data-testid":"subtitle-change-property",hasGreyText:!0,children:"Search and select property to replace current one"}),t(M.Form,{onMarketingModeFieldChange:e=>{y(),m(l=>({...l,marketingMode:e,pageNumber:1}))},onAddressFieldChange:e=>{y(),m(l=>({...l,address:e,pageNumber:1}))}}),x&&!f.length?t(S,{"data-testid":"not-found-properties-list",intent:"default",isExpanded:!0,isInline:!0,isFullWidth:!0,children:"No result!"}):I?t(S,{"data-testid":"error-properties-list",intent:"danger",isExpanded:!0,isInline:!0,isFullWidth:!0,children:u==null?void 0:u.readableMessage}):r.address?N(g,{children:[t(M.Table,{data:f,onCardClick:e=>{C(e),P.openModal()},marketingMode:r.marketingMode[0]}),(o==null?void 0:o.totalPageCount)!==r.pageNumber&&t("div",{ref:A,className:"el-mt8 el-mb10","data-testid":"bottom-loader",children:t(H,{"data-testid":"loading-properties-list"})}),c&&t(q,{"data-testid":"scroll-to-top-fab",className:Z.fabWrapper,icon:"upSystem",onClick:_})]}):t(g,{}),t(ee,{}),t(K,{ModalInstance:P,title:"Change Property",message:`Select ${Q(n==null?void 0:n.address)}?`,ctaIntent:"primary",ctaMessage:"Yes",ctaConfirmFn:v,isCtaLoading:L})]})})};export{Me as default};
