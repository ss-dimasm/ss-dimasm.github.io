import{a as y,j as e,F}from"./index-154d360c.js";import{d as n,i as H,f as Q,O as X,C as z,h as N,D as b,e as m,a6 as r,ax as J,aa as T}from"./elements-7fcf5525.js";import{u as I}from"./index-03f71f46.js";import{u as K,H as Z,t as ee,a2 as te,V as ae,W as ne}from"./app-071066e2.js";import{u as se}from"./use-frequently-appointment-update-4fcce533.js";import{M as oe}from"./modal-dialog-9f685d64.js";import{u as re,S as x,g as ie,b as de}from"./search-attendee.helper-2f041583.js";import{e as ce}from"./index-afe42bc9.js";import{F as le}from"./feedback-button-cfab76c4.js";import"./url-7b6b21ab.js";import"./index-b5e9b2df.js";import"./with-plugins-9d0f23e8.js";import"./isBetween-bb99a4b7.js";import"./isSameOrAfter-571fd34c.js";import"./index.esm-70abc844.js";import"./index.esm-c689e26d.js";import"./index-51ec00a3.js";import"./index-fa19f396.js";import"./index-c5c95794.js";import"./search-results.helpers-369a93a4.js";import"./routes-4ccd8c9c.js";import"./rooms-naming-0ec8ee01.js";import"./regex-aa179d17.js";import"./useInfiniteQuery-6b18b22b.js";import"./index-6d471c01.js";function Ve({appointmentId:u}){var C;const M=K(),{trackEvent:k}=Z(),[{searchInput:c,applicantType:L,attendeeType:s},l]=n.useState({searchInput:null,applicantType:"sales",attendeeType:"applicant"}),[h,_]=n.useState({}),f=!!Object.keys(h).length,{data:a,error:i,isError:v,isLoading:P,isFetching:D,fetchNextPage:O,hasNextPage:V}=re({type:s,searchInput:c,marketingMode:L,options:{enabled:!f&&!!c}}),g=H("root"),[d,E]=n.useState(null),w=!((C=a==null?void 0:a.pages)!=null&&C.length)||!a.pages[0]._embedded.length||i instanceof ee,j=t=>{g.openModal(),E(t)},{ref:R,inView:S}=I(),{ref:B,inView:A}=I(),{update:W,isLoading:G}=se(u),U=async()=>{k(ae.INTERACTION_SECTION,{...ne("DIARY"),Name:"Linked attendee on the appointment has been changed",Action:"Confirm the change attendee button","Event Type":"Click"})(),await W({attendee:{confirmed:!1,id:d==null?void 0:d.id,type:s},attendeeConfirmed:!1}),E(null),M({pathname:`/${u}`},{replace:!0})},[Y,$]=n.useState(!1);n.useEffect(()=>{S&&O()},[S]),n.useEffect(()=>{$(!A)},[A]);const p="extended-change-attendee-appointment",q=()=>{const t=document.getElementById(p);t==null||t.scroll({top:0,behavior:"smooth"})};return y(Q,{id:p,"data-testid":p,children:[e(X,{children:"Select New Attendee"}),e(z,{hasGreyText:!0,children:"Search and select attendee to replace current one"}),e("div",{ref:B,children:e(x.Form,{onSearchFieldChange:t=>{l(o=>({...o,searchInput:ie(t,s)}))},onApplicantTypeChange:t=>{l(o=>({...o,applicantType:t}))},onAttendeeTypeChange:t=>{l(o=>({...o,attendeeType:t}))},subscribeToFormErrorState:_})}),P&&D?e(N,{"data-testid":"search-attendee-loader",className:b(T,r)}):f?e(m,{className:r,isExpanded:!0,intent:"danger",isInline:!0,isFullWidth:!0,children:Object.values(h)[0].message}):v?e(m,{className:r,isExpanded:!0,intent:"danger",isInline:!0,isFullWidth:!0,children:(i==null?void 0:i.readableMessage)||te.DEFAULT}):c?w?e(m,{className:r,isExpanded:!0,intent:"default",isInline:!0,isFullWidth:!0,children:"No result!"}):y(F,{children:[e(x.Table,{data:a==null?void 0:a.pages.flatMap(t=>t),attendeeType:s,onCardClick:j}),Y&&e(J,{"data-testid":"scroll-to-top-fab",className:ce.fabWrapper,icon:"upSystem",onClick:q}),V&&e("div",{ref:R,className:b(r,T),"data-testid":"bottom-loader",children:e(N,{})})]}):e(F,{}),e(le,{}),e(oe,{ModalInstance:g,title:"Change Attendee",message:`Select ${de(s,d).name}?`,ctaIntent:"primary",ctaMessage:"Yes",ctaConfirmFn:U,isCtaLoading:G})]})}export{Ve as default};
