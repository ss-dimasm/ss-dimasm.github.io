import{j as n,a as m,F as Me}from"./index-154d360c.js";import{r as be,k as xe,l as p,n as u,V as ae,E as ne,o as T,v as ue,z as Ie,p as Pe,af as Qe,I as Ke,u as De,a2 as Ze,x as Ce,y as fe,i as ze,Z as ea,F as aa,T as na,O as ta,f as ia,h as la,S as sa,e as ra,q as oa,H as ua,aD as ma}from"./elements-7fcf5525.js";import{a as da,j as F,b as ca,u as ha,e as pa,q as ga,m as Ue}from"./app-071066e2.js";import{c as ke}from"./index-fa19f396.js";import{Q as oe,U as qe}from"./url-7b6b21ab.js";import{u as ba,b as Ma}from"./index-177f51cd.js";import{b as Aa,a as va}from"./index-bf805427.js";import{u as Ia,a as Ra,b as Ta}from"./index-ab606b29.js";import{u as Ea,c as fa}from"./index-07d4f0a6.js";import{a as ya}from"./index-f7763248.js";import{a as Ge,u as Na,F as Sa}from"./index.esm-70abc844.js";import{u as Xe,g as Pa}from"./use-property-marketing-mode-store-c99dcc0a.js";import{D as We,I as Ca,u as je,p as Te}from"./input-price-70e89f01.js";import{T as Ve,I as La,E as _a,d as Le,L as xa,a as Ga,e as Oa,f as Ha}from"./options-f2badf58.js";import{a as _e}from"./options-21b6589e.js";import{f as Fa,e as $,c as Q,a as I,o as Ua}from"./index.esm-c689e26d.js";import{w as Be}from"./index-c5c95794.js";import{t as ka}from"./regex-aa179d17.js";import"./extended-yup-validation-f272edd3.js";import{E as r}from"./error-messages-a063dfd8.js";import{b as Va}from"./regex-d912c3f8.js";import"./index-35ae9ffb.js";import"./error-messages-27b293ab.js";const Je=(e,a)=>da({fetchWhenTrue:[e],queryKey:oe.DEPARTMENT.single(e),...a,path:`${qe.DEPARTMENTS}/${e}`}),re=(e,a)=>{const c=We[e];return["DECORATION","FURNISHING"].includes(e)?Object.entries(c).map(([t,i])=>({name:i,value:t})):a!=null&&a.length?a==null?void 0:a.map(t=>({name:c?c[t].split(",")[0]:t,value:t})):[]},Ba=()=>{var g,b,S,o,P,h,_,U,k,f,N,V,B,w,H,E,L,K,X,W,j,J,D,Z;const{register:e,getValues:a,setValue:c,watch:t,formState:{errors:i},trigger:A}=Ge(),R=t("readOnlyFields.isLettingMode"),[l]=Je("G",{staleTime:1e3*60*10}),O=We.SPECIAL_FEATURES[R?"renting":"buying"].map(s=>({name:s,value:s})),M=s=>()=>A(s);return be.useEffect(()=>{a("attributes.internalArea.type")||c("attributes.internalArea.type","squareFeet")},[t("attributes.internalArea")]),be.useEffect(()=>{a("attributes.externalArea.type")||c("attributes.externalArea.type","acres")},[t("attributes.externalArea")]),n("div",{"data-testid":"property-edit-attributes-section-container",children:m(xe,{hasMargin:!0,children:[n(p,{children:n(u,{"data-testid":"property-bedroom-min",type:"number",min:0,label:"Bedrooms From",...e("attributes.bedrooms",{onChange:M("attributes.bedroomsMax")}),errorMessage:(b=(g=i==null?void 0:i.attributes)==null?void 0:g.bedrooms)==null?void 0:b.message})}),n(p,{children:n(u,{"data-testid":"property-bedroom-max",label:"Bedrooms To",type:"number",min:0,...e("attributes.bedroomsMax",{onChange:M("attributes.bedrooms")}),errorMessage:(o=(S=i==null?void 0:i.attributes)==null?void 0:S.bedroomsMax)==null?void 0:o.message})}),n(p,{children:n(u,{"data-testid":"property-bathroom-min",label:"Bathrooms From",type:"number",min:0,...e("attributes.bathrooms",{onChange:M("attributes.bathroomsMax")}),errorMessage:(h=(P=i==null?void 0:i.attributes)==null?void 0:P.bathrooms)==null?void 0:h.message})}),n(p,{children:n(u,{"data-testid":"property-bathroom-max",label:"Bathrooms To",type:"number",min:0,...e("attributes.bathroomsMax",{onChange:M("attributes.bathrooms")}),errorMessage:(U=(_=i==null?void 0:i.attributes)==null?void 0:_.bathroomsMax)==null?void 0:U.message})}),n(p,{children:n(u,{"data-testid":"property-reception-min",label:"Reception Rooms From",type:"number",min:0,...e("attributes.receptions",{onChange:M("attributes.receptionsMax")}),errorMessage:(f=(k=i==null?void 0:i.attributes)==null?void 0:k.receptions)==null?void 0:f.message})}),n(p,{children:n(u,{"data-testid":"property-reception-max",label:"Reception Rooms To",type:"number",...e("attributes.receptionsMax",{onChange:M("attributes.receptions")}),errorMessage:(V=(N=i==null?void 0:i.attributes)==null?void 0:N.receptionsMax)==null?void 0:V.message})}),n(ae,{children:m(u,{"data-testid":"type-options-wrapper",children:[n(ne,{noneSelectedLabel:"Please select from the options below",id:"type-options","data-testid":"property-type-options",...e("attributes.type",{setValueAs:s=>F(s)?Array.isArray(s)?s:s.split(","):[]}),defaultValues:a("attributes.type"),options:re("TYPE",l==null?void 0:l.typeOptions)}),n(T,{children:"Type"})]})}),n(ae,{children:m(u,{"data-testid":"type-options-wrapper",children:[n(ne,{noneSelectedLabel:"Please select from the options below",id:"locality-options","data-testid":"property-locality-options",...e("attributes.locality",{setValueAs:s=>F(s)?Array.isArray(s)?s:s.split(","):[]}),defaultValues:a("attributes.locality"),options:re("LOCALITY",l==null?void 0:l.localityOptions)}),n(T,{children:"Locality"})]})}),n(ae,{children:m(u,{"data-testid":"type-options-wrapper",children:[n(ne,{noneSelectedLabel:"Please select from the options below",id:"style-options","data-testid":"property-style-options",...e("attributes.style",{setValueAs:s=>F(s)?Array.isArray(s)?s:s.split(","):[]}),defaultValues:a("attributes.style"),options:re("STYLE",l==null?void 0:l.styleOptions)}),n(T,{children:"Style"})]})}),n(ae,{children:m(u,{"data-testid":"type-options-wrapper",children:[n(ne,{noneSelectedLabel:"Please select from the options below",id:"age-options","data-testid":"property-age-options",...e("attributes.age",{setValueAs:s=>F(s)?Array.isArray(s)?s:s.split(","):[]}),defaultValues:a("attributes.age"),options:re("AGE",l==null?void 0:l.ageOptions)}),n(T,{children:"Age"})]})}),n(ae,{children:m(u,{"data-testid":"type-options-wrapper",children:[n(ne,{noneSelectedLabel:"Please select from the options below",id:"situation-options","data-testid":"property-situation-options",...e("attributes.situation",{setValueAs:s=>F(s)?Array.isArray(s)?s:s.split(","):[]}),defaultValues:a("attributes.situation"),options:re("SITUATION",l==null?void 0:l.situationOptions)}),n(T,{children:"Situation"})]})}),n(ae,{children:m(u,{"data-testid":"type-options-wrapper",children:[n(ne,{noneSelectedLabel:"Please select from the options below",id:"parking-options","data-testid":"property-parking-options",...e("attributes.parking",{setValueAs:s=>F(s)?Array.isArray(s)?s:s.split(","):[]}),defaultValues:a("attributes.parking"),options:re("PARKING",l==null?void 0:l.parkingOptions)}),n(T,{children:"Parking"})]})}),n(ae,{children:m(u,{"data-testid":"type-options-wrapper",children:[n(ne,{noneSelectedLabel:"Please select from the options below",id:"special-features-options","data-testid":"property-special-features-options",defaultValues:a("attributes.specialFeatures"),...e("attributes.specialFeatures",{setValueAs:s=>F(s)?Array.isArray(s)?s:s.split(","):[]}),options:O}),n(T,{children:"Special Features"})]})}),R?m(Me,{children:[n(ae,{children:m(u,{"data-testid":"type-options-wrapper",children:[n(ne,{noneSelectedLabel:"Please select from the options below",id:"furnishing-options","data-testid":"property-letting-furnishing-options",...e("attributes.letting.furnishing",{setValueAs:s=>F(s)?Array.isArray(s)?s:s.split(","):[]}),defaultValues:a("attributes.letting.furnishing"),options:re("FURNISHING")}),n(T,{children:"Furnishing"})]})}),n(p,{children:m(u,{children:[n(T,{children:"Tenure"}),m(ue,{...e("attributes.letting.term"),children:[n("option",{value:"",children:"Select Tenure"}),Object.entries(Ve.renting).map(([s,x])=>n("option",{value:s,children:x},s))]})]})})]}):m(Me,{children:[n(ae,{children:m(u,{"data-testid":"type-options-wrapper",children:[n(ne,{noneSelectedLabel:"Please select from the options below",id:"decoration-options","data-testid":"property-sales-decoration-options",...e("attributes.selling.decoration",{setValueAs:s=>F(s)?Array.isArray(s)?s:s.split(","):[]}),defaultValues:a("attributes.selling.decoration"),options:re("DECORATION")}),n(T,{children:"Decoration"}),n(Ie,{message:""})]})}),n(ae,{children:m(u,{children:[n(T,{children:"Tenure"}),m(ue,{...e("attributes.selling.tenure.type"),children:[n("option",{value:"",children:"Select Tenure"}),Object.entries(Ve.buying).map(([s,x])=>n("option",{value:s,children:x},s))]})]})})]}),n(p,{children:m(u,{children:[n(T,{children:"Internal Area Type"}),n(Pe,{...e("attributes.internalArea.type"),hasGreyBg:!0,options:Object.entries(La).map(([s,x])=>({id:`option-${s}`,value:s,text:x,isChecked:s===t("attributes.internalArea.type")})),"data-testid":"internal-area-type-options"})]})}),n(p,{children:n(u,{type:"number",min:0,label:"Minimum Internal Area",...e("attributes.internalArea.min",{onChange:M("attributes.internalArea.max")}),errorMessage:(H=(w=(B=i.attributes)==null?void 0:B.internalArea)==null?void 0:w.min)==null?void 0:H.message})}),n(p,{children:n(u,{type:"number",min:0,label:"Maximum Internal Area",...e("attributes.internalArea.max",{onChange:M("attributes.internalArea.min")}),errorMessage:(K=(L=(E=i.attributes)==null?void 0:E.internalArea)==null?void 0:L.max)==null?void 0:K.message})}),n(p,{children:m(u,{children:[n(T,{children:"External Area Type"}),n(Pe,{...e("attributes.externalArea.type"),hasGreyBg:!0,options:Object.entries(_a).map(([s,x])=>({id:`option-${s}`,value:s,text:x,isChecked:s===t("attributes.externalArea.type")})),"data-testid":"external-area-type-options"})]})}),n(p,{children:n(u,{type:"number",min:0,label:"Minimum External Area",...e("attributes.externalArea.min",{onChange:M("attributes.externalArea.max")}),errorMessage:(j=(W=(X=i.attributes)==null?void 0:X.externalArea)==null?void 0:W.min)==null?void 0:j.message})}),n(p,{children:n(u,{type:"number",min:0,label:"Maximum External Area",...e("attributes.externalArea.max",{onChange:M("attributes.externalArea.min")}),errorMessage:(Z=(D=(J=i.attributes)==null?void 0:J.externalArea)==null?void 0:D.max)==null?void 0:Z.message})})]})})},Se=[{value:"GB",name:"United Kingdom"},{value:"AF",name:"Afghanistan"},{value:"AX",name:"Ã…land Islands"},{value:"AL",name:"Albania"},{value:"DZ",name:"Algeria"},{value:"AS",name:"American Samoa"},{value:"AD",name:"Andorra"},{value:"AO",name:"Angola"},{value:"AI",name:"Anguilla"},{value:"AQ",name:"Antarctica"},{value:"AG",name:"Antigua and Barbuda"},{value:"AR",name:"Argentina"},{value:"AM",name:"Armenia"},{value:"AW",name:"Aruba"},{value:"AU",name:"Australia"},{value:"AT",name:"Austria"},{value:"AZ",name:"Azerbaijan"},{value:"BS",name:"Bahamas"},{value:"BH",name:"Bahrain"},{value:"BD",name:"Bangladesh"},{value:"BB",name:"Barbados"},{value:"BY",name:"Belarus"},{value:"BE",name:"Belgium"},{value:"BZ",name:"Belize"},{value:"BJ",name:"Benin"},{value:"BM",name:"Bermuda"},{value:"BT",name:"Bhutan"},{value:"BO",name:"Bolivia, Plurinational State of"},{value:"BQ",name:"Bonaire, Sint Eustatius and Saba"},{value:"BA",name:"Bosnia and Herzegovina"},{value:"BW",name:"Botswana"},{value:"BV",name:"Bouvet Island"},{value:"BR",name:"Brazil"},{value:"IO",name:"British Indian Ocean Territory"},{value:"BN",name:"Brunei Darussalam"},{value:"BG",name:"Bulgaria"},{value:"BF",name:"Burkina Faso"},{value:"BI",name:"Burundi"},{value:"KH",name:"Cambodia"},{value:"CM",name:"Cameroon"},{value:"CA",name:"Canada"},{value:"CV",name:"Cape Verde"},{value:"KY",name:"Cayman Islands"},{value:"CF",name:"Central African Republic"},{value:"TD",name:"Chad"},{value:"CL",name:"Chile"},{value:"CN",name:"China"},{value:"CX",name:"Christmas Island"},{value:"CC",name:"Cocos (Keeling) Islands"},{value:"CO",name:"Colombia"},{value:"KM",name:"Comoros"},{value:"CG",name:"Congo"},{value:"CD",name:"Congo, the Democratic Republic of the"},{value:"CK",name:"Cook Islands"},{value:"CR",name:"Costa Rica"},{value:"CI",name:"CÃ´te d'Ivoire"},{value:"HR",name:"Croatia"},{value:"CU",name:"Cuba"},{value:"CW",name:"CuraÃ§ao"},{value:"CY",name:"Cyprus"},{value:"CZ",name:"Czech Republic"},{value:"DK",name:"Denmark"},{value:"DJ",name:"Djibouti"},{value:"DM",name:"Dominica"},{value:"DO",name:"Dominican Republic"},{value:"EC",name:"Ecuador"},{value:"EG",name:"Egypt"},{value:"SV",name:"El Salvador"},{value:"GQ",name:"Equatorial Guinea"},{value:"ER",name:"Eritrea"},{value:"EE",name:"Estonia"},{value:"ET",name:"Ethiopia"},{value:"FK",name:"Falkland Islands (Malvinas)"},{value:"FO",name:"Faroe Islands"},{value:"FJ",name:"Fiji"},{value:"FI",name:"Finland"},{value:"FR",name:"France"},{value:"GF",name:"French Guiana"},{value:"PF",name:"French Polynesia"},{value:"TF",name:"French Southern Territories"},{value:"GA",name:"Gabon"},{value:"GM",name:"Gambia"},{value:"GE",name:"Georgia"},{value:"DE",name:"Germany"},{value:"GH",name:"Ghana"},{value:"GI",name:"Gibraltar"},{value:"GR",name:"Greece"},{value:"GL",name:"Greenland"},{value:"GD",name:"Grenada"},{value:"GP",name:"Guadeloupe"},{value:"GU",name:"Guam"},{value:"GT",name:"Guatemala"},{value:"GG",name:"Guernsey"},{value:"GN",name:"Guinea"},{value:"GW",name:"Guinea-Bissau"},{value:"GY",name:"Guyana"},{value:"HT",name:"Haiti"},{value:"HM",name:"Heard Island and McDonald Islands"},{value:"VA",name:"Holy See (Vatican City State)"},{value:"HN",name:"Honduras"},{value:"HK",name:"Hong Kong"},{value:"HU",name:"Hungary"},{value:"IS",name:"Iceland"},{value:"IN",name:"India"},{value:"ID",name:"Indonesia"},{value:"IR",name:"Iran, Islamic Republic of"},{value:"IQ",name:"Iraq"},{value:"IE",name:"Ireland"},{value:"IM",name:"Isle of Man"},{value:"IL",name:"Israel"},{value:"IT",name:"Italy"},{value:"JM",name:"Jamaica"},{value:"JP",name:"Japan"},{value:"JE",name:"Jersey"},{value:"JO",name:"Jordan"},{value:"KZ",name:"Kazakhstan"},{value:"KE",name:"Kenya"},{value:"KI",name:"Kiribati"},{value:"KP",name:"Korea, Democratic People's Republic of"},{value:"KR",name:"Korea, Republic of"},{value:"KW",name:"Kuwait"},{value:"KG",name:"Kyrgyzstan"},{value:"LA",name:"Lao People's Democratic Republic"},{value:"LV",name:"Latvia"},{value:"LB",name:"Lebanon"},{value:"LS",name:"Lesotho"},{value:"LR",name:"Liberia"},{value:"LY",name:"Libya"},{value:"LI",name:"Liechtenstein"},{value:"LT",name:"Lithuania"},{value:"LU",name:"Luxembourg"},{value:"MO",name:"Macao"},{value:"MK",name:"Macedonia, the former Yugoslav Republic of"},{value:"MG",name:"Madagascar"},{value:"MW",name:"Malawi"},{value:"MY",name:"Malaysia"},{value:"MV",name:"Maldives"},{value:"ML",name:"Mali"},{value:"MT",name:"Malta"},{value:"MH",name:"Marshall Islands"},{value:"MQ",name:"Martinique"},{value:"MR",name:"Mauritania"},{value:"MU",name:"Mauritius"},{value:"YT",name:"Mayotte"},{value:"MX",name:"Mexico"},{value:"FM",name:"Micronesia, Federated States of"},{value:"MD",name:"Moldova, Republic of"},{value:"MC",name:"Monaco"},{value:"MN",name:"Mongolia"},{value:"ME",name:"Montenegro"},{value:"MS",name:"Montserrat"},{value:"MA",name:"Morocco"},{value:"MZ",name:"Mozambique"},{value:"MM",name:"Myanmar"},{value:"NA",name:"Namibia"},{value:"NR",name:"Nauru"},{value:"NP",name:"Nepal"},{value:"NL",name:"Netherlands"},{value:"NC",name:"New Caledonia"},{value:"NZ",name:"New Zealand"},{value:"NI",name:"Nicaragua"},{value:"NE",name:"Niger"},{value:"NG",name:"Nigeria"},{value:"NU",name:"Niue"},{value:"NF",name:"Norfolk Island"},{value:"MP",name:"Northern Mariana Islands"},{value:"NO",name:"Norway"},{value:"OM",name:"Oman"},{value:"PK",name:"Pakistan"},{value:"PW",name:"Palau"},{value:"PS",name:"Palestinian Territory, Occupied"},{value:"PA",name:"Panama"},{value:"PG",name:"Papua New Guinea"},{value:"PY",name:"Paraguay"},{value:"PE",name:"Peru"},{value:"PH",name:"Philippines"},{value:"PN",name:"Pitcairn"},{value:"PL",name:"Poland"},{value:"PT",name:"Portugal"},{value:"PR",name:"Puerto Rico"},{value:"QA",name:"Qatar"},{value:"RE",name:"RÃ©union"},{value:"RO",name:"Romania"},{value:"RU",name:"Russian Federation"},{value:"RW",name:"Rwanda"},{value:"BL",name:"Saint BarthÃ©lemy"},{value:"SH",name:"Saint Helena, Ascension and Tristan da Cunha"},{value:"KN",name:"Saint Kitts and Nevis"},{value:"LC",name:"Saint Lucia"},{value:"MF",name:"Saint Martin (French part)"},{value:"PM",name:"Saint Pierre and Miquelon"},{value:"VC",name:"Saint Vincent and the Grenadines"},{value:"WS",name:"Samoa"},{value:"SM",name:"San Marino"},{value:"ST",name:"Sao Tome and Principe"},{value:"SA",name:"Saudi Arabia"},{value:"SN",name:"Senegal"},{value:"RS",name:"Serbia"},{value:"SC",name:"Seychelles"},{value:"SL",name:"Sierra Leone"},{value:"SG",name:"Singapore"},{value:"SX",name:"Sint Maarten (Dutch part)"},{value:"SK",name:"Slovakia"},{value:"SI",name:"Slovenia"},{value:"SB",name:"Solomon Islands"},{value:"SO",name:"Somalia"},{value:"ZA",name:"South Africa"},{value:"GS",name:"South Georgia and the South Sandwich Islands"},{value:"SS",name:"South Sudan"},{value:"ES",name:"Spain"},{value:"LK",name:"Sri Lanka"},{value:"SD",name:"Sudan"},{value:"SR",name:"Suriname"},{value:"SJ",name:"Svalbard and Jan Mayen"},{value:"SZ",name:"Swaziland"},{value:"SE",name:"Sweden"},{value:"CH",name:"Switzerland"},{value:"SY",name:"Syrian Arab Republic"},{value:"TW",name:"Taiwan, Province of China"},{value:"TJ",name:"Tajikistan"},{value:"TZ",name:"Tanzania, United Republic of"},{value:"TH",name:"Thailand"},{value:"TL",name:"Timor-Leste"},{value:"TG",name:"Togo"},{value:"TK",name:"Tokelau"},{value:"TO",name:"Tonga"},{value:"TT",name:"Trinidad and Tobago"},{value:"TN",name:"Tunisia"},{value:"TR",name:"Turkey"},{value:"TM",name:"Turkmenistan"},{value:"TC",name:"Turks and Caicos Islands"},{value:"TV",name:"Tuvalu"},{value:"UG",name:"Uganda"},{value:"UA",name:"Ukraine"},{value:"AE",name:"United Arab Emirates"},{value:"US",name:"United States"},{value:"UM",name:"United States Minor Outlying Islands"},{value:"UY",name:"Uruguay"},{value:"UZ",name:"Uzbekistan"},{value:"VU",name:"Vanuatu"},{value:"VE",name:"Venezuela, Bolivarian Republic of"},{value:"VN",name:"Viet Nam"},{value:"VG",name:"Virgin Islands, British"},{value:"VI",name:"Virgin Islands, U.S."},{value:"WF",name:"Wallis and Futuna"},{value:"EH",name:"Western Sahara"},{value:"YE",name:"Yemen"},{value:"ZM",name:"Zambia"},{value:"ZW",name:"Zimbabwe"}],wa=()=>{var R,l,O,M,g,b,S,o,P,h,_,U,k,f,N,V,B,w,H,E,L,K,X,W,j,J,D,Z,s,x,me,de,ce,te,he,pe,ie,le,se;const{register:e,getValues:a,watch:c,formState:{errors:t},control:i}=Ge(),{readOnlyFields:{isLettingMode:A}}=c();return n("div",{"data-testid":"property-edit-details-section-container",children:m(xe,{hasMargin:!0,children:[n(p,{children:n(u,{"data-testid":"property-address-house-name",label:"House Name / Flat",...e("propertyDetails.address.buildingName"),errorMessage:(O=(l=(R=t==null?void 0:t.propertyDetails)==null?void 0:R.address)==null?void 0:l.buildingName)==null?void 0:O.message})}),n(p,{children:n(u,{type:"number",min:0,"data-testid":"property-address-house-number",label:"House Number",...e("propertyDetails.address.buildingNumber"),errorMessage:(b=(g=(M=t==null?void 0:t.propertyDetails)==null?void 0:M.address)==null?void 0:g.buildingNumber)==null?void 0:b.message})}),n(p,{children:n(u,{"data-testid":"property-address-line-1",label:"Address Line 1",...e("propertyDetails.address.line1"),errorMessage:(P=(o=(S=t==null?void 0:t.propertyDetails)==null?void 0:S.address)==null?void 0:o.line1)==null?void 0:P.message})}),n(p,{children:n(u,{"data-testid":"property-address-line-2",label:"Address Line 2",...e("propertyDetails.address.line2"),errorMessage:(U=(_=(h=t==null?void 0:t.propertyDetails)==null?void 0:h.address)==null?void 0:_.line2)==null?void 0:U.message})}),n(p,{children:n(u,{"data-testid":"property-address-line-3",label:"Address Line 3",...e("propertyDetails.address.line3"),errorMessage:(N=(f=(k=t==null?void 0:t.propertyDetails)==null?void 0:k.address)==null?void 0:f.line3)==null?void 0:N.message})}),n(p,{children:n(u,{"data-testid":"property-address-line-4",label:"Address Line 4",...e("propertyDetails.address.line4"),errorMessage:(w=(B=(V=t==null?void 0:t.propertyDetails)==null?void 0:V.address)==null?void 0:B.line4)==null?void 0:w.message})}),n(p,{children:n(u,{"data-testid":"property-address-postcode ",label:"Postcode",...e("propertyDetails.address.postcode"),errorMessage:(L=(E=(H=t==null?void 0:t.propertyDetails)==null?void 0:H.address)==null?void 0:E.postcode)==null?void 0:L.message})}),m(p,{children:[n(T,{children:"Country"}),n(Qe,{id:"countryId","data-testid":"property-address-country-id",defaultVal:Se.find(y=>y.value===a("propertyDetails.address.countryId")),getResults:y=>{const C=Se.filter(({name:ge})=>ge.toLowerCase().includes(y.toLowerCase()));return Promise.resolve(C.length>0&&y?C:Se)},getResultLabel:y=>y.name,getResultValue:y=>y.value,...e("propertyDetails.address.countryId")}),n(Ie,{message:((W=(X=(K=t==null?void 0:t.propertyDetails)==null?void 0:K.address)==null?void 0:X.countryId)==null?void 0:W.message)??""})]}),A&&n(p,{children:m(u,{children:[n(T,{children:"Rent Frequency"}),m(ue,{"data-testid":"property-letting-rent-frequency",...e("propertyDetails.letting.rentFrequency"),children:[n("option",{value:"",children:"None selected"}),Object.entries(Le).map(([y,C])=>n("option",{value:y,children:C},y))]}),n(Ie,{message:((D=(J=(j=t.propertyDetails)==null?void 0:j.letting)==null?void 0:J.rentFrequency)==null?void 0:D.message)??""})]})}),n(p,{children:n(Ca,{control:i,"data-testid":"property-pricing-price",label:A?"Letting Fee":"Selling Price",name:`propertyDetails.${A?"letting.rent":"selling.price"}`,errorMessage:A?(x=(s=(Z=t==null?void 0:t.propertyDetails)==null?void 0:Z.letting)==null?void 0:s.rent)==null?void 0:x.message:(ce=(de=(me=t==null?void 0:t.propertyDetails)==null?void 0:me.selling)==null?void 0:de.price)==null?void 0:ce.message})}),n(p,{children:m(u,{label:"Qualifier",children:[n(T,{children:"Qualifier"}),m(ue,{"data-testid":"property-pricing-qualifier",...e(`propertyDetails.${A?"letting":"selling"}.qualifier`),children:[n("option",{value:"",children:"None selected"}),Object.entries(A?xa:Ga).map(([y,C])=>n("option",{value:y,children:C},y))]}),n(Ie,{message:A?((pe=(he=(te=t==null?void 0:t.propertyDetails)==null?void 0:te.letting)==null?void 0:he.qualifier)==null?void 0:pe.message)??"":((se=(le=(ie=t==null?void 0:t.propertyDetails)==null?void 0:ie.selling)==null?void 0:le.qualifier)==null?void 0:se.message)??""})]})})]})})},Ya=()=>{var S,o,P,h,_,U,k,f,N,V,B,w,H,E,L,K,X,W,j,J,D,Z,s,x,me,de,ce,te,he,pe,ie,le,se,y,C,ge,Y,Re,z;const[e]=je(),{register:a,setValue:c,watch:t,formState:{errors:i}}=Ge(),{readOnlyFields:{isLettingMode:A,isRelatedOwnerAContact:R}}=t(),[l]=Ia(),[O]=ca({method:"GET",path:qe.SOURCES}),M=t(`ownerDetails.${A?"landlord":"vendor"}.source.type`),g=be.useCallback(async d=>{const ee=await(M==="office"?l({name:d}):O({name:d}));return(ee==null?void 0:ee._embedded)??[]},[M]),b=d=>{const ee=d.target.value;c(`ownerDetails.${A?"landlord":"vendor"}.source.id`,ee,{shouldDirty:!0})};return n("div",{"data-testid":"property-edit-details-section-container",children:m(xe,{hasMargin:!0,children:[R?m(Me,{children:[n(p,{children:m(u,{children:[m(ue,{...a("ownerDetails.contact.title"),children:[n("option",{value:"",children:"None selected"},"default-option"),Oa.map(d=>n("option",{value:d,children:d},d))]}),n(T,{children:"Please select a title"}),((P=(o=(S=i.ownerDetails)==null?void 0:S.contact)==null?void 0:o.title)==null?void 0:P.message)&&n(Ie,{message:(U=(_=(h=i.ownerDetails)==null?void 0:h.contact)==null?void 0:_.title)==null?void 0:U.message})]})}),n(p,{children:n(u,{"data-testid":"contact-forename",label:"First Name",...a("ownerDetails.contact.forename"),errorMessage:(N=(f=(k=i==null?void 0:i.ownerDetails)==null?void 0:k.contact)==null?void 0:f.forename)==null?void 0:N.message})}),n(p,{children:n(u,{"data-testid":"contact-surname",label:"Surname",...a("ownerDetails.contact.surname"),errorMessage:(w=(B=(V=i==null?void 0:i.ownerDetails)==null?void 0:V.contact)==null?void 0:B.surname)==null?void 0:w.message})})," "]}):n(p,{children:n(u,{"data-testid":"company-name",label:"Company Name",...a("ownerDetails.company.name"),errorMessage:(L=(E=(H=i==null?void 0:i.ownerDetails)==null?void 0:H.company)==null?void 0:E.name)==null?void 0:L.message})}),n(p,{children:n(u,{"data-testid":"contact-email",label:"Email",inputMode:"email",...a(`ownerDetails.${R?"contact":"company"}.email`),errorMessage:R?(W=(X=(K=i==null?void 0:i.ownerDetails)==null?void 0:K.contact)==null?void 0:X.email)==null?void 0:W.message:(D=(J=(j=i==null?void 0:i.ownerDetails)==null?void 0:j.company)==null?void 0:J.email)==null?void 0:D.message})}),n(p,{children:n(u,{"data-testid":"contact-mobile-phone",type:"number",min:0,label:"Mobile Phone",inputMode:"numeric",...a("ownerDetails.contact.mobilePhone"),errorMessage:R?(x=(s=(Z=i==null?void 0:i.ownerDetails)==null?void 0:Z.contact)==null?void 0:s.mobilePhone)==null?void 0:x.message:(ce=(de=(me=i==null?void 0:i.ownerDetails)==null?void 0:me.company)==null?void 0:de.mobilePhone)==null?void 0:ce.message})}),R&&n(p,{children:n(u,{"data-testid":"contact-home-phone",type:"number",min:0,label:"Home Phone",inputMode:"numeric",...a("ownerDetails.contact.homePhone"),errorMessage:(pe=(he=(te=i==null?void 0:i.ownerDetails)==null?void 0:te.contact)==null?void 0:he.homePhone)==null?void 0:pe.message})}),n(p,{children:n(u,{"data-testid":"contact-work-phone",min:0,type:"number",label:"Work Phone",...a("ownerDetails.contact.workPhone"),errorMessage:R?(se=(le=(ie=i==null?void 0:i.ownerDetails)==null?void 0:ie.contact)==null?void 0:le.workPhone)==null?void 0:se.message:(ge=(C=(y=i==null?void 0:i.ownerDetails)==null?void 0:y.company)==null?void 0:C.workPhone)==null?void 0:ge.message})}),n(p,{children:m(u,{children:[m(ue,{...a("ownerDetails.contact.marketingConsent",{setValueAs:d=>d===""?null:d}),"data-testid":"mc-field-marketing-consent",children:[n("option",{value:"",children:"None selected"}),_e.map(d=>n("option",{value:d.id,children:d.value},d.id))]}),n(T,{children:"Marketing Consent"})]})}),!A&&n(p,{children:n(u,{"data-testid":"property-next-call",label:"Next Call",type:"date",...a("ownerDetails.vendor.nextCall"),errorMessage:(z=(Re=(Y=i==null?void 0:i.ownerDetails)==null?void 0:Y.vendor)==null?void 0:Re.nextCall)==null?void 0:z.message})}),n(p,{children:m(u,{children:[n(T,{children:"Source Type"}),n(Pe,{...a(`ownerDetails.${A?"landlord":"vendor"}.source.type`),hasGreyBg:!0,options:Object.entries(Ha).map(([d,ee])=>({id:`option-${d}`,value:d,text:ee,isChecked:M?d===M:d==="source"})),"data-testid":"owner-source-type-options"})]})}),m(p,{children:[n(T,{children:"Source "}),n(Qe,{"data-testid":"owner-source-type-input",getResults:g,getResultLabel:d=>d.name??"",getResultValue:d=>d.id,onChange:b,placeholder:`Search ${M=="source"?"Source":"Inter Office"}`})]}),!A&&m(Me,{children:[n(p,{children:m(u,{children:[n(T,{children:"Selling Reason"}),m(ue,{...a("ownerDetails.vendor.sellingReasonId",{setValueAs:d=>d===""?null:d}),className:"el-wfull",children:[n("option",{value:"",children:"None selected"}),e.sellingReasons.map(d=>n("option",{value:d.id,children:d.value},d.id))]})]})}),n(p,{children:m(u,{children:[n(T,{children:"Vendor Type"}),m(ue,{...a("ownerDetails.vendor.typeId",{setValueAs:d=>d===""?null:d}),className:"el-wfull",children:[n("option",{value:"",children:"None selected"}),e.vendorTypes.map(d=>n("option",{value:d.id,children:d.value},d.id))]})]})})]})]})})},we=({propertyData:e,setValue:a})=>{const{isMobile:c}=Ke(),t=ha(),{selectedMode:i,hasMultipleMode:A,switchMode:R}=Xe(e);return m(Me,{children:[n(De,{"data-testid":"controls-icon",className:"el-mb5",icon:"propertyManagementInfographic",iconSize:"large"}),n(Ze,{"data-testid":"controls-description",hasGreyText:!0,children:"This app provides the tools required to document the outcome of a market appraisal appointment and make changes to an existing property record."}),m(Ce,{"data-testid":"controls-button-group",children:[n(fe,{"data-testid":"controls-button-back",intent:A||!c?"default":"primary",onClick:()=>t(`/${e==null?void 0:e.id}`,{replace:!0}),children:"Back"}),A&&m(fe,{"data-testid":"controls-button-switch-mode",intent:"primary",onClick:()=>{a("readOnlyFields.isLettingMode",i==="letting",{shouldDirty:!0}),R()},children:["Switch to ",i==="selling"?"Rent":"Sales"]})]})]})},Ye=e=>{var O,M,g,b,S,o,P,h,_,U,k,f,N,V,B,w,H;const{property:a,contact:c,company:t,relatedPrimaryPropertyOwner:i}=e;if(!a)return;const A=F(i),R=(i==null?void 0:i.type)==="contact",l=(a==null?void 0:a.marketingMode)==="letting";return{attributes:{bathrooms:a==null?void 0:a.bathrooms,bathroomsMax:a==null?void 0:a.bathroomsMax,bedrooms:a==null?void 0:a.bedrooms,bedroomsMax:a==null?void 0:a.bedroomsMax,receptions:a==null?void 0:a.receptions,receptionsMax:a==null?void 0:a.receptionsMax,type:a==null?void 0:a.type,locality:a==null?void 0:a.locality,style:a==null?void 0:a.style,age:a==null?void 0:a.age,situation:a==null?void 0:a.situation,parking:a==null?void 0:a.parking,specialFeatures:a==null?void 0:a.specialFeatures,externalArea:a.externalArea,internalArea:a.internalArea,selling:{tenure:(O=a.selling)==null?void 0:O.tenure,decoration:(M=a.selling)==null?void 0:M.decoration},letting:{furnishing:(g=a.letting)==null?void 0:g.furnishing,term:(b=a.letting)==null?void 0:b.term}},propertyDetails:{address:a.address,selling:{price:(S=a==null?void 0:a.selling)==null?void 0:S.price,qualifier:(o=a==null?void 0:a.selling)==null?void 0:o.qualifier},letting:{rent:(P=a==null?void 0:a.letting)==null?void 0:P.rent,rentFrequency:l?((h=a==null?void 0:a.letting)==null?void 0:h.rentFrequency)??"":void 0,qualifier:(_=a==null?void 0:a.letting)==null?void 0:_.qualifier}},ownerDetails:{contact:R?{email:c==null?void 0:c.email,mobilePhone:c==null?void 0:c.mobilePhone,homePhone:c==null?void 0:c.homePhone,workPhone:c==null?void 0:c.workPhone,title:c==null?void 0:c.title,forename:c==null?void 0:c.forename,surname:c==null?void 0:c.surname,marketingConsent:c==null?void 0:c.marketingConsent}:{},vendor:{nextCall:(a==null?void 0:a.nextCall)??"",source:(k=(U=a==null?void 0:a._embedded)==null?void 0:U.vendor)==null?void 0:k.source,typeId:(N=(f=a==null?void 0:a._embedded)==null?void 0:f.vendor)==null?void 0:N.typeId,sellingReasonId:(B=(V=a==null?void 0:a._embedded)==null?void 0:V.vendor)==null?void 0:B.sellingReasonId},landlord:{source:(H=(w=a==null?void 0:a._embedded)==null?void 0:w.landlord)==null?void 0:H.source},company:t?{email:t==null?void 0:t.email,mobilePhone:t==null?void 0:t.mobilePhone,workPhone:t==null?void 0:t.workPhone,name:t==null?void 0:t.name,marketingConsent:t==null?void 0:t.marketingConsent}:{}},readOnlyFields:{hasPropertyOwner:A,isLettingMode:l,isRelatedOwnerAContact:R}}},$a=(e,a)=>{var i,A,R,l,O,M,g,b,S;const c=(i=a==null?void 0:a.readOnlyFields)==null?void 0:i.isLettingMode;let t="";if(c){const o=Te((A=e==null?void 0:e.letting)==null?void 0:A.rent),P=Be(Le[((R=e==null?void 0:e.letting)==null?void 0:R.rentFrequency)??""]," "),h=Te((l=a==null?void 0:a.propertyDetails.letting)==null?void 0:l.rent),_=Be(Le[((M=(O=a==null?void 0:a.propertyDetails)==null?void 0:O.letting)==null?void 0:M.rentFrequency)??""]," ");t=`Price changed from ${o} ${P} to ${h} ${_}`}else{const o=Te((g=e==null?void 0:e.selling)==null?void 0:g.price),P=Te((S=(b=a==null?void 0:a.propertyDetails)==null?void 0:b.selling)==null?void 0:S.price);t=`Price changed from ${o} to ${P}`}return{propertyId:e==null?void 0:e.id,typeId:"PC",description:t}},$e=(e,a,c,t)=>{var i;return{propertyId:e,associatedType:t,associatedId:a.id,typeId:"MI",description:`Marketing Consent changed from ${a!=null&&a.marketingConsent?_e[a==null?void 0:a.marketingConsent]:"Unknown"} to ${_e[(i=c[t])==null?void 0:i.marketingConsent]}`}},Ee=e=>{let a="";return e.homePhone&&(a+=`h: ${e.homePhone}; `),e.mobilePhone&&(a+=`m: ${e.mobilePhone}; `),e.workPhone&&(a+=`w: ${e.workPhone}; `),e.email&&(a+=`e: ${e.email}; `),a.length?a:"Unknown"},Qa=e=>(e.bedrooms&&e.bedrooms>((e==null?void 0:e.bedroomsMax)??0)&&(e.bedroomsMax=e==null?void 0:e.bedrooms),e.bathrooms&&e.bathrooms>((e==null?void 0:e.bathroomsMax)??0)&&(e.bathroomsMax=e==null?void 0:e.bathrooms),e.receptions&&e.receptions>((e==null?void 0:e.receptionsMax)??0)&&(e.receptionsMax=e==null?void 0:e.receptions),e);Fa($,"maxNumberLength",function(e){return this.test({name:"max-number-length-validator",message:r.MAXIMUM_DIGIT_LENGTH(e),test:a=>a!=null?`${a}`.length<=e:!0})});const ve={test:e=>e==null?!0:Va.test(e)},Ka=Q().shape({propertyDetails:Q().shape({selling:Q().shape({price:$().integer(r.TYPE_ERROR("Round Number","Price")).transform((e,a)=>e==null||a===null?null:Number(a.toString().replace(/,/g,""))).maxNumberLength(9).nullable(),qualifier:I().trim().nullable()}),letting:Q().shape({rent:$().integer(r.TYPE_ERROR("Round Number","Price")).transform((e,a)=>e==null||a===null?null:Number(a.toString().replace(/,/g,""))).maxNumberLength(9).nullable(),rentFrequency:I().trim().nullable(),qualifier:I().trim().nullable()}),address:Q().shape({buildingName:I().trim().max(35,({max:e})=>r.MAXIMUM_CHARACTER_LENGTH(e)).nullable(),buildingNumber:I().trim().max(8,({max:e})=>r.MAXIMUM_CHARACTER_LENGTH(e)).nullable(),line1:I().trim().max(35,({max:e})=>r.MAXIMUM_CHARACTER_LENGTH(e)).nullable(),line2:I().trim().max(35,({max:e})=>r.MAXIMUM_CHARACTER_LENGTH(e)).nullable(),line3:I().trim().max(35,({max:e})=>r.MAXIMUM_CHARACTER_LENGTH(e)).nullable(),line4:I().trim().max(35,({max:e})=>r.MAXIMUM_CHARACTER_LENGTH(e)).nullable(),postcode:I().trim().max(8,({max:e})=>r.MAXIMUM_CHARACTER_LENGTH(e)).nullable()})}),ownerDetails:Q().shape({contact:Q().transform(e=>Object.keys(e).length?e:null).shape({title:I().trim().max(15,({max:e})=>r.MAXIMUM_CHARACTER_LENGTH(e)).nullable().matches(ka,r.SPECIFIC_INVALID_PATTERN("Title")),forename:I().trim().max(20,({max:e})=>r.MAXIMUM_CHARACTER_LENGTH(e)).nullable(),surname:I().trim().max(45,({max:e})=>r.MAXIMUM_CHARACTER_LENGTH(e)).nullable(),mobilePhone:I().transform(e=>isNaN(e)||e===""?null:e).typeError(r.SPECIFIC_INVALID_PATTERN("phone number")).test({...ve,message:r.TYPE_ERROR("Number","Mobile Phone")}).min(11,r.MINIMUM_CHARACTER_LENGTH(11)).nullable(),homePhone:I().transform(e=>isNaN(e)||e===""?null:e).typeError(r.SPECIFIC_INVALID_PATTERN("phone number")).test({...ve,message:r.TYPE_ERROR("Number","Home Phone")}).min(11,r.MINIMUM_CHARACTER_LENGTH(11)).nullable(),workPhone:I().transform(e=>isNaN(e)||e===""?null:e).typeError(r.SPECIFIC_INVALID_PATTERN("phone number")).test({...ve,message:r.TYPE_ERROR("Number","Work Phone")}).min(11,r.MINIMUM_CHARACTER_LENGTH(11)).nullable(),email:I().trim().email(r.SPECIFIC_INVALID_PATTERN("email address")).nullable()}).nullable(),company:Q().transform(e=>Object.keys(e).length?e:null).shape({name:I().trim().max(45,({max:e})=>r.MAXIMUM_CHARACTER_LENGTH(e)).nullable(),mobilePhone:I().transform(e=>isNaN(e)||e===""?null:e).typeError(r.SPECIFIC_INVALID_PATTERN("phone number")).test({...ve,message:r.TYPE_ERROR("Number","Mobile Phone")}).min(11,r.MINIMUM_CHARACTER_LENGTH(11)).nullable(),workPhone:I().transform(e=>isNaN(e)||e===""?null:e).typeError(r.SPECIFIC_INVALID_PATTERN("phone number")).test({...ve,message:r.TYPE_ERROR("Number","Work Phone")}).min(11,r.MINIMUM_CHARACTER_LENGTH(11)).nullable(),email:I().trim().email(r.SPECIFIC_INVALID_PATTERN("email address"))}).nullable(),vendor:Q().shape({nextCall:I().trim().nullable()})}),attributes:Q().shape({bathrooms:$().transform((e,a)=>a===""||a===null?0:e).nullable().typeError(r.TYPE_ERROR("Number","Bathroom From")).min(0,r.HIGHER_OR_EQUAL_THAN("Bathroom From","0")).max(999,r.MAXIMUM_DIGIT_LENGTH(3)),bathroomsMax:$().transform((e,a)=>a===""||a===null?0:+e).nullable().typeError(r.TYPE_ERROR("Number","Bathroom To")).min(0,r.HIGHER_OR_EQUAL_THAN("Bathroom To","0")).max(999,r.MAXIMUM_DIGIT_LENGTH(3)),bedrooms:$().transform((e,a)=>a===""||a===null?0:e).nullable().typeError(r.TYPE_ERROR("Number","Bedroom From")).min(0,r.HIGHER_OR_EQUAL_THAN("Bedroom From","0")).max(999,r.MAXIMUM_DIGIT_LENGTH(3)),bedroomsMax:$().transform((e,a)=>a===""||a===null?0:e).nullable().typeError(r.TYPE_ERROR("Number","Bedroom To")).min(0,r.HIGHER_OR_EQUAL_THAN("Bedroom To","0")).max(999,r.MAXIMUM_DIGIT_LENGTH(3)),receptions:$().transform((e,a)=>a===""||a===null?0:e).nullable().typeError(r.TYPE_ERROR("Number","Reception Room From")).min(0,r.HIGHER_OR_EQUAL_THAN("Reception Room From","0")).max(999,r.MAXIMUM_DIGIT_LENGTH(3)),receptionsMax:$().transform((e,a)=>a===""||a===null?0:e).nullable().typeError(r.TYPE_ERROR("Number","Reception Room To")).min(0,r.HIGHER_OR_EQUAL_THAN("Reception Room To","0")).max(999,r.MAXIMUM_DIGIT_LENGTH(3)),internalArea:Q().shape({type:I().transform(e=>e===""||e===void 0||e===null?null:e).nullable().typeError(r.TYPE_ERROR("Text","Internal Area Type")),min:$().nullable().transform(e=>isNaN(e)?0:e).minHighNumberValidator({minField:"attributes.internalArea.min",maxField:"attributes.internalArea.max"},r.LOWER_OR_EQUAL_THAN("Min Internal Area","Max Internal Area")).max(999999,r.MAXIMUM_DIGIT_LENGTH(6)),max:$().nullable().transform(e=>isNaN(e)?0:e).minHighNumberValidator({minField:"attributes.internalArea.min",maxField:"attributes.internalArea.max"},r.HIGHER_OR_EQUAL_THAN("Max Internal Area","Min Internal Area")).max(999999,r.MAXIMUM_DIGIT_LENGTH(6))}).nullable(),externalArea:Q().shape({min:$().nullable().transform(e=>isNaN(e)?0:e).minHighNumberValidator({minField:"attributes.externalArea.min",maxField:"attributes.externalArea.max"},r.LOWER_OR_EQUAL_THAN("Min External Area","Max External Area")).max(999999,r.MAXIMUM_DIGIT_LENGTH(6)),max:$().nullable().transform(e=>isNaN(e)?0:e).minHighNumberValidator({minField:"attributes.externalArea.min",maxField:"attributes.externalArea.max"},r.HIGHER_OR_EQUAL_THAN("Max External Area","Min External Area")).max(999999,r.MAXIMUM_DIGIT_LENGTH(6))}).nullable()})}),qa=()=>{const{propertyId:e}=pa(),{isMobile:a}=Ke(),{Modal:c,openModal:t,closeModal:i}=ze(),[A,R]=be.useState("attributes"),[l,,{isLoading:O}]=Ea(e,{fetchWhenTrue:[!!e],queryParams:{embed:["landlord","vendor","images"]}}),{selectedMode:M}=Xe(l),{primaryContact:g,data:b}=Pa(l,M)??{},S=(g==null?void 0:g.type)==="contact",[o,,{isLoading:P}]=Aa(g==null?void 0:g.id,{fetchWhenTrue:[S,!!(g!=null&&g.id)]}),[h,,{isLoading:_}]=ba(g==null?void 0:g.id,{fetchWhenTrue:[!S,!!(g!=null&&g.id)]}),[,,{isLoading:U}]=je(),[,,{isLoading:k}]=Je("G",{staleTime:1e3*60*60*12}),[f]=ya({errorMessage:"Failed to Create Journal Entry"}),N=Na({defaultValues:Ye({property:{...l,marketingMode:M},contact:o,company:h,relatedPrimaryPropertyOwner:g}),resolver:Ua(Ka),mode:"onChange"}),{handleSubmit:V,reset:B,formState:{isValidating:w,errors:H},getFieldState:E}=N;be.useEffect(()=>{F(l)&&B(Ye({property:{...l,marketingMode:M},contact:o,company:h,relatedPrimaryPropertyOwner:g}))},[l,h,o,g,M]);const L=ga(),K=ea(),[X,,,{isLoading:W}]=fa((l==null?void 0:l.id)??"",{useIdPath:!0,shouldReturnRecord:!0,headers:{"if-match":(l==null?void 0:l._eTag)??""}}),[j,,,{isLoading:J}]=va((o==null?void 0:o.id)??"",{useIdPath:!0,shouldReturnRecord:!0,headers:{"if-match":(o==null?void 0:o._eTag)??""}}),[D,,,{isLoading:Z}]=Ma((h==null?void 0:h.id)??"",{useIdPath:!0,shouldReturnRecord:!0,headers:{"if-match":(h==null?void 0:h._eTag)??""}}),[s,,,{isLoading:x}]=Ra((b==null?void 0:b.id)??"",{useIdPath:!0,shouldReturnRecord:!0,headers:{"if-match":(b==null?void 0:b._eTag)??""}}),[me,,,{isLoading:de}]=Ta((b==null?void 0:b.id)??"",{useIdPath:!0,shouldReturnRecord:!0,headers:{"if-match":(b==null?void 0:b._eTag)??""}}),ce=O||k||_||P||U,te=W||J||x||de||Z,he=async C=>{var ee,Oe,He,Fe;const{attributes:ge,ownerDetails:Y,propertyDetails:Re}=C,z=[];let d={};if(E("propertyDetails").isDirty&&(d=Re,(E("propertyDetails.selling.price").isDirty||E("propertyDetails.letting.rent").isDirty)&&f($a(l,C))),E("attributes").isDirty&&(d={...d,...Qa(ge)}),Object.keys(d).length&&z.push(X(Ue.omit(d,le?"selling":"letting")).then(G=>{L.setQueryData(oe.PROPERTY.single(l==null?void 0:l.id),v=>({...v,...Ue.omit(G,"_embedded")}))})),E("ownerDetails").isDirty){if(E("ownerDetails.contact").isDirty){const G=ke(o==null?void 0:o.title,o==null?void 0:o.forename,o==null?void 0:o.surname),v=ke((ee=Y.contact)==null?void 0:ee.title,(Oe=Y.contact)==null?void 0:Oe.forename,(He=Y.contact)==null?void 0:He.surname);G!=v&&f({propertyId:l==null?void 0:l.id,associatedId:o==null?void 0:o.id,associatedType:"contact",typeId:"DC",description:`Name changed from ${G} to ${v}`});const q=Ee(o),Ae=Ee(o);q!=Ae&&f({propertyId:l==null?void 0:l.id,associatedId:o==null?void 0:o.id,associatedType:"contact",typeId:"DC",description:`Contact details changed from ${q} to ${Ae}`}),E("ownerDetails.contact.marketingConsent").isDirty&&f($e(l==null?void 0:l.id,o,Y,"contact")),z.push(j(Y.contact).then(ye=>{L.setQueryData(oe.CONTACT.single(o==null?void 0:o.id),Ne=>({...Ne,...ye}))}))}if(E("ownerDetails.company").isDirty){const G=h==null?void 0:h.name,v=(Fe=Y.company)==null?void 0:Fe.name;G!=v&&f({propertyId:l==null?void 0:l.id,associatedId:h==null?void 0:h.id,associatedType:"company",typeId:"DC",description:`Name changed from ${G} to ${v}`});const q=Ee(h),Ae=Ee(h);q!=Ae&&f({propertyId:l==null?void 0:l.id,associatedId:h==null?void 0:h.id,associatedType:"company",typeId:"DC",description:`Company details changed from ${q} to ${Ae}`}),E("ownerDetails.company.marketingConsent").isDirty&&f($e(l==null?void 0:l.id,h,Y,"company")),z.push(D(Y.company).then(ye=>{L.setQueryData(oe.COMPANY.single(h==null?void 0:h.id),Ne=>({...Ne,...ye}))}))}E("ownerDetails.vendor").isDirty&&z.push(s(Y.vendor).then(G=>{L.setQueryData(oe.VENDOR.single(b==null?void 0:b.id),v=>({...v,...G})),L.setQueryData(oe.PROPERTY.single(l==null?void 0:l.id),v=>{var q;return{...v,nextCall:G.nextCall,_embedded:{...(v==null?void 0:v._embedded)??{},vendor:{...((q=v==null?void 0:v._embedded)==null?void 0:q.vendor)??{},...G}}}})})),E("ownerDetails.landlord").isDirty&&z.push(me(Y.landlord).then(G=>{L.setQueryData(oe.LANDLORD.single(b==null?void 0:b.id),v=>({...v,...G})),L.setQueryData(oe.PROPERTY.single(l==null?void 0:l.id),v=>{var q;return{...v,_embedded:{...(v==null?void 0:v._embedded)??{},landlord:{...((q=v==null?void 0:v._embedded)==null?void 0:q.landlord)??{},...G}}}})}))}z.length&&((await Promise.allSettled(z)).every(v=>v.status==="fulfilled")?K.success("Update successiful"):K.error("Something went wrong, Update failed"))},pe=F(l)&&F(N.getValues("readOnlyFields.isLettingMode")),ie=!!H&&!!Object.values(H).length&&!w,le=N.watch("readOnlyFields.isLettingMode"),se=le?"Landlord":"Vendor",y=be.useMemo(()=>{const C=[{id:"attributes",text:"Attributes",value:"attributes",isChecked:A==="attributes"},{id:"property-details",text:"Property Details",value:"property-details",isChecked:A==="property-details"}];return F(g)&&C.push({id:"owner-details",text:`${se} Details`,value:"owner-details",isChecked:A==="owner-details"}),C},[g,se]);return m(aa,{isFlexGrow1:!0,children:[m(na,{children:[n(ta,{children:"Market Appraisals"}),n(we,{propertyData:l,setValue:N.setValue})]}),n(ia,{children:ce?n(la,{"data-testid":"edit-property-loader",fullPage:!0}):pe&&m(Me,{children:[a&&m(c,{title:"Controls",children:[n(we,{propertyData:l,setValue:N.setValue}),n(Ce,{alignment:"center",className:"el-mt5",children:n(fe,{intent:"default",onClick:i,children:"Close"})})]}),n(sa,{isFullWidth:!0,name:"edit-property-detail-tab","data-testid":"edit-property-detail-tab",options:y,onChange:C=>R(C.currentTarget.value)}),n("form",{className:"el-mb12",children:m(Sa,{...N,children:[A==="attributes"?n(Ba,{}):A==="property-details"?n(wa,{}):n(Ya,{}),ie&&n(ra,{className:oa,isExpanded:!0,isFullWidth:!0,isInline:!0,intent:"danger",children:"There are one or more errors in the form that are preventing you from saving the contact. Please check each section to proceeed."}),n(Ce,{className:ua,alignment:"left",children:n(fe,{intent:"primary",onClick:V(he),disabled:te||ie,loading:te,children:"Update"})})]})}),n(ma,{onClick:t})]})})]})},Mn=qa;export{Mn as default};
